(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f;}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var BasePicListManager=
require("../../other/base-pic-list-manager.js");var picListManager=new BasePicListManager({onChapListBuilt:function(chap){var self=this;self.processItem(chap);self.cachePos(chap.cid)},onPicLoadOK:function(img){var self=this,$img=$(img),$item=$img.parents("li.comic-pic-item"),cid=$item.attr("data-cid")|0;self.cachePos(cid)},loadNearbyImages:function(progress,loadRange){var self=this,posCache=self.posCache,allPics=posCache.allPics,rangeUp=loadRange.up,rangeDown=loadRange.down,cid=progress.cid,cur=progress.cur;
var chap=posCache.findChap(cid),begin=chap.beginOfAll;var pic,picsBefore=[],picsAfter=[],pos=cur-1+begin;for(var ui=0;ui<rangeUp;ui++){pic=allPics[pos-ui-1];pic&&pic.unloaded&&picsBefore.push(pic.pid)}for(var di=0;di<rangeDown;di++){pic=allPics[pos+di];pic&&pic.unloaded&&picsAfter.push(pic.pid)}self.waitingPicQueue=picsBefore;self._loadPicsOfIds(picsAfter);if(!picsAfter.length)self._loadWaitingPicQueue()},areaHeight:0,posCache:{chapPics:[],allPics:[],findChap:function(cid){var chapPics=this.chapPics;
for(var i=0,l=chapPics.length;i<l;i++){var chap=chapPics[i];if(chap&&chap.cid===cid)return chap}return null},removeChap:function(cid){var chap=this.findChap(cid),pos=this.chapPics.indexOf(chap);pos>=0&&this.chapPics.splice(pos,1)}},processItem:function(chap){var self=this,$list=self.findChapList(chap);$list.find("li.comic-pic-item").each(function(){var $item=$(this),$pad=$item.find("div.comic-pic-pad");var w=$pad.attr("data-width")|0,h=$pad.attr("data-height")|0,ph=parseFloat(h*100/w);$pad.css("padding-top",
ph+"%")})},cachePos:function(chap){var self=this,posCache=self.posCache,chapPics=posCache.chapPics,list=self.findChapList(chap),$list=list?$(list):$("ul.comic-pic-list");$list.each(function(){var $list=$(this),cid=$list.attr("data-cid")|0,seq=$list.attr("data-seq")|0;posCache.removeChap(cid);chap={cid:cid,seq:seq,pics:[]};chapPics.push(chap);$list.find("li.comic-pic-item").each(function(){var $item=$(this),pid=$item.attr("data-pid")|0,unloaded=$item.is(".pic-unloaded"),item=$item[0];chap.pics.push({pid:pid,
top:item.offsetTop,bottom:item.offsetTop+item.clientHeight,unloaded:unloaded})})});chapPics.sort(function(a,b){return a.seq-b.seq});var allPics=[];for(var i=0,l=chapPics.length;i<l;i++){chap=chapPics[i];chap.beginOfAll=allPics.length;var pics=chap.pics;allPics=allPics.concat(pics)}posCache.allPics=allPics;self.areaHeight=$(".comic-pic-area").offset().height;console.log("areaHeight=="+self.areaHeight)},getPicPos:function(cid,cur){var self=this,posCache=self.posCache,chap=posCache.findChap(cid),pic=
chap&&chap.pics[cur-1];return pic?pic.top:null},getScrollProgress:function(scrollTop,screenHeight){var self=this,posCache=self.posCache,chapPics=posCache.chapPics,checkLine=scrollTop+screenHeight/2,chapIndex=0,chap,pics;for(var ci=0,cl=chapPics.length;ci<cl;ci++){chap=chapPics[ci];pics=chap&&chap.pics;var first=pics[0],last=pics[pics.length-1];if(first.top>checkLine)break;if(last.bottom<checkLine){if(ci+1>=cl){chapIndex=cl-1;break}continue}chapIndex=ci}chap=chapPics[chapIndex];pics=chap.pics;var total=
pics.length,cid=chap.cid,seq=chap.seq,progress={cid:cid,seq:seq,cur:1,total:total};for(var pi=0,pic;pi<total;pi++){pic=pics[pi];if(pic.top>=checkLine)break;progress.cur=pi+1}return progress}});module.exports=picListManager},{"../../other/base-pic-list-manager.js":10}],2:[function(require,module,exports){var scrollHandler={_listeners:[],STATUS:{NOT_READY:0,PREPARING:1,OK:2},status:0,init:function(opt){opt=opt||{};var self=this,scrollElem=opt.scrollElem||document.body,scrollBox=scrollElem===document.body?
document.documentElement:scrollElem,eventTarget=scrollElem===document.body?window:scrollElem;self.scrollElem=scrollElem;self.scrollBox=scrollBox;self.eventTarget=eventTarget;self.status=self.STATUS.NOT_READY;eventTarget.addEventListener("scroll",ek.func.throttle(function(e){if(self.status===self.STATUS.NOT_READY){e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();return}self.trigger&&self.trigger(e)},100))},whenScroll:function(listener){var self=this;if(typeof listener!==
"function")throw new Error("\u6eda\u52a8listener\u5fc5\u987b\u662ffunction");self._listeners.push(listener)},scrollElemChanged:function(){},trigger:function(_e){var self=this,listeners=this._listeners,e=_e||{};e.top=self.getTop();for(var i=0,l;l=listeners[i];i++)l(e)},scrollTo:function(top){var self=this,eventTarget=self.eventTarget,scrollBox=self.scrollBox;if(eventTarget===window)window.scrollTo(0,top);else scrollBox.scrollTop=top;self.trigger({top:top})},getTop:function(){var self=this;var scrollElem=
self.scrollElem,scrollBox=self.scrollBox;return scrollBox.scrollTop||scrollElem.scrollTop||window.scrollY||window.pageYOffset},getHeight:function(){var self=this;var scrollElem=self.scrollElem,scrollBox=self.scrollBox;return scrollBox.scrollHeight||scrollElem.scrollHeight||scrollElem.clientHeight}};module.exports=scrollHandler},{}],3:[function(require,module,exports){var BaseComicPicArea=require("../../view/base-comic-pic-area.js"),picListManager=require("../other/pic-list-manager.js"),scrollHandler=
require("../other/scroll-handler.js");module.exports=function(){var vw_ComicPicArea=new BaseComicPicArea({name:"vw_ComicPicArea",picListManager:picListManager,init:function(){var self=this;self.bindScrollEvents();window.addEventListener("resize",function(){picListManager.cachePos()});self.on("chapListBuilt",function(e){var page=self.page,comicData=page.get("ComicData"),initChap=comicData.initChap,chap=e.chap,isInitChap=String(chap.cid)===String(initChap.cid);if(isInitChap){var initPageIndex=page.initPageIndex,
isStart=initPageIndex==="start",isLast=initPageIndex==="last";initPageIndex=isLast?initChap.picList.length:parseInt(initPageIndex);if(isStart)self.returnToStart();else self.locateTo(chap.cid,initPageIndex);window.setTimeout(function(){scrollHandler.status=scrollHandler.STATUS.PREPARING;if(isStart)self.returnToStart();else self.locateTo(chap.cid,initPageIndex);$(".comic-pic-list-loading").hide().offset();window.setTimeout(function(){scrollHandler.status=scrollHandler.STATUS.OK},100)},100)}else self.calculateReadProgress()})},
events:{"click .comic-pic-area":function(e){var self=this,page=self.page,$target=$(e.target),$parent=$target.parents(".app-guiding");if($parent.length);else page&&page.trigger("clickMainArea")}},locateTo:function(cid,cur){var top=picListManager.getPicPos(cid,cur);if(top===null){console.error("\u8bbe\u7f6e\u7684\u8fdb\u5ea6\u6709\u8bef\uff0c\u65e0\u6cd5\u627e\u5230\u5bf9\u5e94\u7ae0\u8282\u6216\u56fe\u7247\uff01");return}scrollHandler.scrollTo(top)},returnToStart:function(){scrollHandler.scrollTo(0)},
nearBottomRange:2E3,scrollTop:0,bindScrollEvents:function(){var self=this;scrollHandler.init({scrollElem:document.body});scrollHandler.whenScroll(function(){if(scrollHandler.status===scrollHandler.STATUS.OK){var page=self.page;page.trigger("hideFloatBar")}});self.calculateReadProgress_debounce=ek.func.debounce(self.calculateReadProgress,100,self);scrollHandler.whenScroll(function(e){var page=self.page,comicData=page.get("ComicData"),picCount=picListManager.picCount,lastCid=picListManager.lastBuiltCid,
nextCid=comicData.getNextChapID(lastCid);var top=e.top|0,nearBottomPos=picListManager.areaHeight-self.nearBottomRange;self.scrollTop=top;self.calculateReadProgress_debounce();if(top>=nearBottomPos&&picCount<self.pagePicLimit)if(nextCid&&!comicData.hasChapDetail(nextCid))page.trigger("needChapDetail",{cid:nextCid})})},calculateReadProgress:function(){var self=this,scrollTop=self.scrollTop,screenSize=self.screenSize,progress=picListManager.getScrollProgress(scrollTop,screenSize.height);self.setReadProgress(progress)}});
return vw_ComicPicArea}},{"../../view/base-comic-pic-area.js":14,"../other/pic-list-manager.js":1,"../other/scroll-handler.js":2}],4:[function(require,module,exports){var BasePicListManager=require("../../other/base-pic-list-manager.js");var picListManager=new BasePicListManager({onChapListBuilt:function(chap){},onPicLoadOK:function(img){var self=this;self.adjustWorkingPicBox()},loadNearbyImages:function(progress,loadRange){var self=this,rangeUp=loadRange.up,rangeDown=loadRange.down,cid=progress.cid,
cur=progress.cur,allPics=$(".comic-pic-item"),curPic=allPics.filter('[data-cid="'+cid+'"][data-index="'+cur+'"]'),pos=allPics.indexOf(curPic.get(0));var pic,picsBefore=[],picsAfter=[];for(var ui=0;ui<rangeUp;ui++){pic=$(allPics[pos-ui-1]);pic.is(".pic-unloaded")&&picsBefore.push(pic.attr("data-pid"))}for(var di=0;di<rangeDown;di++){pic=$(allPics[pos+di]);pic.is(".pic-unloaded")&&picsBefore.push(pic.attr("data-pid"))}self.waitingPicQueue=picsBefore;self._loadPicsOfIds(picsAfter);if(!picsAfter.length)self._loadWaitingPicQueue()},
_currentProgress:{cid:null,seq:null,cur:null,total:null,workingPics:[null,null,null]},getCurrentProgress:function(){return this._currentProgress},setCurrentProgress:function(cid,cur,useTrans){var curPro=this._currentProgress,workingPics=curPro.workingPics;var allPics=$(".comic-pic-item"),chapPicList=$('.comic-pic-list[data-cid="'+cid+'"]'),chapPics=chapPicList.find(".comic-pic-item"),chapFirstPos=allPics.indexOf(chapPics.get(0));var curPos=chapFirstPos+cur-1,prevPic=$(allPics[curPos-1]),curPic=$(allPics[curPos]),
nextPic=$(allPics[curPos+1]);chapPicList=curPic.parents(".comic-pic-list");chapPics=chapPicList.find(".comic-pic-item");cid=parseInt(chapPicList.attr("data-cid"));cur=parseInt(curPic.attr("data-index"));var seq=parseInt(chapPicList.attr("data-seq")),total=chapPics.length;if(chapFirstPos<0||!cid||!cur||!seq){console.error("\u8bbe\u7f6e\u7684\u8fdb\u5ea6\u6709\u8bef\uff0c\u65e0\u6cd5\u627e\u5230\u5bf9\u5e94\u7ae0\u8282\u6216\u56fe\u7247\uff01");return curPro}curPro.cid=cid;curPro.seq=seq;curPro.cur=
cur;curPro.total=total;this.disableTrans();workingPics[0]=prevPic;workingPics[1]=curPic;workingPics[2]=nextPic;allPics.each(function(){var $this=$(this),isWorking=$this.is(".working")==true;isWorking&&$this.removeClass("working").attr("data-was-working","1")});for(var i=0,l=workingPics.length;i<l;i++){var pic=workingPics[i];if(pic){var ts="translate3d("+(i-1)*100+"%,0,0)",wasWorking=pic.attr("data-was-working");pic.addClass("working");if(wasWorking)useTrans&&this.enableTrans([pic]);pic.css({"-webkit-transform":ts,
"transform":ts})}}allPics.each(function(){var $this=$(this),isWorking=$this.is(".working")==true;!isWorking&&$this.css({"-webkit-transform":"","transform":""}).attr("data-was-working","")});this.adjustWorkingPicBox();return curPro},setWorkingPicState:function(pdx){var curPro=this._currentProgress,workingPics=curPro.workingPics;for(var i=0,l=workingPics.length;i<l;i++){var pic=workingPics[i],ts="translate3d("+((i-1)*100+pdx)+"%,0,0)";pic&&pic.css({"-webkit-transform":ts,"transform":ts})}},adjustWorkingPicBox:function(){var curPro=
this._currentProgress,workingPics=curPro.workingPics;for(var i=0,l=workingPics.length;i<l;i++){var pic=workingPics[i],pad=pic.find(".comic-pic-pad"),box=pic.find(".comic-pic-box"),img=pic.find(".comic-pic");if(!pic.is(".pic-loaded")||!pad.length||!box.length||!img.length)continue;var orgWidth=pad.attr("data-width")|0,orgHeight=pad.attr("data-height")|0,imgRatio=orgWidth/orgHeight,boxWidth=box.offset().width,boxHeight=box.offset().height,boxRatio=boxWidth/boxHeight;if(imgRatio>boxRatio)img.css({width:boxWidth,
height:orgHeight*(boxWidth/orgWidth)});else img.css({width:orgWidth*(boxHeight/orgHeight),height:boxHeight})}},disableTrans:function(_targetPics){var curPro=this._currentProgress,workingPics=curPro.workingPics,targetPics=_targetPics||workingPics;for(var i=0,l=targetPics.length;i<l;i++){var pic=targetPics[i];pic&&pic.removeClass("trans").each(this._repaint)}},enableTrans:function(_targetPics){var curPro=this._currentProgress,workingPics=curPro.workingPics,targetPics=_targetPics||workingPics;for(var i=
0,l=targetPics.length;i<l;i++){var pic=targetPics[i];pic&&pic.addClass("trans").each(this._repaint)}}});module.exports=picListManager},{"../../other/base-pic-list-manager.js":10}],5:[function(require,module,exports){var swipeHandler={_listeners:{fingerDown:[],fingerMove:[],fingerUp:[],pan:[],swipe:[]},STATUS:{NOT_READY:0,PREPARING:1,OK:2},status:0,swipeElem:null,init:function(opts){this.swipeElem=opts.swipeElem;this.canClick=opts.canClick;this.status=this.STATUS.NOT_READY;this._bindEvents()},on:function(type,
listener){var listeners=this._listeners[type]||[];if(typeof listener==="function")listeners.push(listener)},trigger:function(type,e){var listeners=this._listeners[type]||[],args=[].slice.call(arguments,1);for(var i=0,l;l=listeners[i];i++)if(l.apply(this,args)===false)return false},_touchStatus:{fingerDown:false,startPos:{x:0,y:0},lastPos:{x:0,y:0},startTime:0,lastMoveTime:0},_eventListeners:{start:function(e){var status=this._touchStatus;if(this.status!==this.STATUS.OK||status.fingerDown)return;var p=
this._touchPosOfEvent(e),now=(new Date).getTime();e.status=status;e.dx=0;e.dy=0;if(this.trigger("fingerDown",e)===false)return;status.fingerDown=true;status.startPos=status.lastPos=p;status.startTime=status.lastMoveTime=now},move:function(e){var status=this._touchStatus;if(!status.fingerDown)return;var p=this._touchPosOfEvent(e),now=(new Date).getTime(),sp=status.startPos,lt=status.lastMoveTime;if(now-lt<=10)return;e.stopPropagation();e.preventDefault();e.status=status;e.dx=p.x-sp.x;e.dy=p.y-sp.y;
if(this.trigger("fingerMove",e)===false)return;status.lastPos=p;status.lastMoveTime=now;this.trigger("pan",e)},end:function(e){var status=this._touchStatus;if(!status.fingerDown)return;status.fingerDown=false;var lp=status.lastPos,sp=status.startPos,et=(new Date).getTime(),st=status.startTime;e.status=status;e.dx=lp.x-sp.x;e.dy=lp.y-sp.y;e.time=et-st;e.dis2=Math.pow(e.dx,2)+Math.pow(e.dy,2);e.speed2=e.dis2/Math.pow(e.time,2);e.eDis2=e.speed2*Math.pow(500,2);e.isClick=e.dis2<100&&e.time<300;e.isSwipe=
e.dis2>1E4||e.eDis2>1E4;if(this.trigger("fingerUp",e)===false)return;e.isSwipe&&this.trigger("swipe",e)}},_bindEvents:function(){var self=this,swipeElem=self.swipeElem,isSupportTouch="ontouchend"in document,eventListeners=self._eventListeners,eventNames={start:isSupportTouch?"touchstart":"mousedown",move:isSupportTouch?"touchmove":"mousemove",end:isSupportTouch?"touchend":["mouseup","mouseleave"]};for(var name in eventNames){if(!eventNames.hasOwnProperty(name))return;var ens=eventNames[name],listener=
eventListeners[name];if(Object.prototype.toString.call(ens)!=="[object Array]")ens=[ens];listener=function(listener){return function(){listener.apply(self,arguments)}}(listener);for(var i=0,en;en=ens[i];i++)swipeElem.addEventListener(en,listener)}},_touchPosOfEvent:function(e){var t=e.touches?e.touches[0]:e;var x=t.pageX||t.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft);var y=t.pageY||t.clientY+(document.documentElement.scrollTop||document.body.scrollTop);return{x:x,y:y}}};
module.exports=swipeHandler},{}],6:[function(require,module,exports){var BaseComicPicArea=require("../../view/base-comic-pic-area.js"),picListManager=require("../other/pic-list-manager.js"),swipeHandler=require("../other/swipe-handler.js");module.exports=function(){var vw_ComicPicArea=new BaseComicPicArea({name:"vw_ComicPicArea",picListManager:picListManager,init:function(){var self=this;self.bindSwipeEvents();self.on("chapListBuilt",function(e){var page=self.page,comicData=page.get("ComicData"),
initChap=comicData.initChap,chap=e.chap,isInitChap=String(chap.cid)===String(initChap.cid);if(isInitChap){var initPageIndex=page.initPageIndex;initPageIndex=initPageIndex==="last"?initChap.picList.length:parseInt(initPageIndex);swipeHandler.status=swipeHandler.STATUS.PREPARING;window.setTimeout(function(){vw_ComicPicArea.locateTo(chap.cid,initPageIndex);$(".comic-pic-list-loading").hide().offset();window.setTimeout(function(){swipeHandler.status=swipeHandler.STATUS.OK},500)},100)}});$(window).on("resize",
function(){picListManager.adjustWorkingPicBox()})},locateTo:function(cid,cur,useTrans){var self=this,page=self.page,comicData=page.get("ComicData"),picCount=picListManager.picCount,progress=picListManager.setCurrentProgress(cid,cur,useTrans);self.setReadProgress(progress);if(picCount<self.pagePicLimit){if(progress.cur<3){var prevCid=comicData.getPrevChapID(cid);if(prevCid&&!comicData.hasChapDetail(prevCid))page.trigger("needChapDetail",{cid:prevCid})}if(progress.cur+3>=progress.total){var nextCid=
comicData.getNextChapID(cid);if(nextCid&&!comicData.hasChapDetail(nextCid))page.trigger("needChapDetail",{cid:nextCid})}}},returnToStart:function(){var self=this,page=self.page,comicData=page.get("ComicData"),initChap=comicData.initChap,cid=initChap.cid;self.locateTo(cid,1)},bindSwipeEvents:function(){var self=this;swipeHandler.init({swipeElem:document.querySelector(".comic-pic-area"),canClick:function(e){var target=e.target;return $(target).closest(".nav-ctrl-btn, .app-guiding, .control-btn, .comic-item")[0]}});
swipeHandler.on("swipe",function(){var page=self.page;page.trigger("hideFloatBar")});swipeHandler.on("fingerDown",function(){picListManager.disableTrans();self.holdBackCtrlBtn()});swipeHandler.on("fingerUp",function(e){var isClick=e.isClick,isSwipe=e.isSwipe,status=e.status,curPro=picListManager.getCurrentProgress(),cid=curPro.cid,cur=curPro.cur;if(isClick){if(swipeHandler.canClick&&swipeHandler.canClick(e))return;var page=self.page,screenSize=self.screenSize,lp=status.lastPos,px=lp.x/screenSize.width;
if(px<.3){self.goPrevOrNext(-1,false);page.trigger("clickSideArea",{part:"left"})}else if(px>.7){self.goPrevOrNext(1,false);page.trigger("clickSideArea",{part:"right"})}else page.trigger("clickMainArea")}else if(!isSwipe)self.locateTo(cid,cur,true)});swipeHandler.on("pan",function(e){var dx=e.dx,direction=e.dx<0?1:-1,screenSize=self.screenSize,pdx=Number((dx*100/screenSize.width).toFixed(2)),curPro=picListManager.getCurrentProgress(),cid=curPro.cid,cur=curPro.cur,total=curPro.total,hasLeft=cur>1||
picListManager.hasPrevList(cid),hasRight=cur<total||picListManager.hasNextList(cid);if(self.isEndChapAdsAnimating()||self.isEndChapAdsShowing()||!hasLeft&&direction<0||!hasRight&&direction>0)return;picListManager.setWorkingPicState(pdx)});swipeHandler.on("swipe",function(e){var dx=e.dx,direction=dx<0?1:-1;self.goPrevOrNext(direction,true)})},goPrevOrNext:function(direction,useTrans){var self=this,curPro=picListManager.getCurrentProgress(),cid=curPro.cid,cur=curPro.cur,total=curPro.total,hasLeft=cur>
1||picListManager.hasPrevList(cid),hasRight=cur<total||picListManager.hasNextList(cid);var page=self.page,comicData=page.get("ComicData");if(self.isEndChapAdsAnimating())return;if(direction<0&&self.isEndChapAdsShowing()){this.holdBackEndChapAds();return}if(!hasRight&&direction>0&&!comicData.getNextChapID(cid)&&self.isEndChapAdsAvailable()){this.callOutEndChapAds();return}if(!hasLeft&&direction<0||!hasRight&&direction>0){self.callOutCtrlBtn(direction,true);return}self.locateTo(cid,cur+direction,useTrans)},
callOutCtrlBtn:function(direction,autoClick){if(!direction){this.holdBackCtrlBtn(-1);this.holdBackCtrlBtn(1);return}var self=this,timeouts=self._ctrlBtnTimeout,timeout=timeouts[direction],ctrlBtn=$(".nav-ctrl-btn"+(direction<0?".prev":direction>0?".next":"")),isClickAble=!ctrlBtn.attr("data-disabled")&&ctrlBtn.attr("data-can-read")=="2";if(autoClick&&isClickAble)ctrlBtn.click();else{ctrlBtn.addClass("show").each(this._repaint);timeout&&window.clearTimeout(timeout);ctrlBtn.addClass("in");timeouts[direction]=
window.setTimeout(function(){timeouts[direction]=null},2500)}},holdBackCtrlBtn:function(direction){if(!direction){this.holdBackCtrlBtn(-1);this.holdBackCtrlBtn(1);return}var self=this,timeouts=self._ctrlBtnTimeout,timeout=timeouts[direction],ctrlBtn=$(".nav-ctrl-btn"+(direction<0?".prev":direction>0?".next":""));timeout&&window.clearTimeout(timeout);ctrlBtn.removeClass("in");timeouts[direction]=window.setTimeout(function(){timeouts[direction]=null;ctrlBtn.removeClass("show")},500)},_ctrlBtnTimeout:{},
_repaint:new Function("this.clientWidth"),callOutEndChapAds:function(){var self=this,status=self._endChapAdsStatus,ads=$(".end-chapter-ads");if(status.animating||!self.isEndChapAdsAvailable())return;ads.show().each(self._repaint);ads.addClass("in");status.animating=true;window.setTimeout(function(){status.animating=false;status.showing=true},500)},holdBackEndChapAds:function(){var self=this,status=self._endChapAdsStatus,ads=$(".end-chapter-ads");if(status.animating||!status.showing)return;ads.removeClass("in");
status.animating=true;window.setTimeout(function(){var ads=$(".end-chapter-ads");ads.hide();status.animating=false;status.showing=false},500)},isEndChapAdsAvailable:function(){var ads=$(".end-chapter-ads"),isDisabled=ads.find(".cooperation-state").css("display")==="none";return!isDisabled},isEndChapAdsAnimating:function(){var self=this,status=self._endChapAdsStatus;return status.animating},isEndChapAdsShowing:function(){var self=this,status=self._endChapAdsStatus;return status.showing},_endChapAdsStatus:{animating:false,
showing:false}});return vw_ComicPicArea}},{"../../view/base-comic-pic-area.js":14,"../other/pic-list-manager.js":4,"../other/swipe-handler.js":5}],7:[function(require,module,exports){var md_ComicData=new BIU.Model({name:"ComicData",dataProto:{hasChapDetail:function(cid){var data=this,chapData=data.chapData;return!!chapData[cid]},getChapByID:function(cid){var data=this,chapList=data.chapList;cid=String(cid);for(var i=0,len=chapList.length;i<len;i++){var chap=chapList[i];if(String(chap.cid)===cid)return chap}return null},
getPrevChapID:function(_chapOrCid){var data=this,chapList=data.chapList,cid=typeof _chapOrCid==="object"?_chapOrCid.cid:_chapOrCid,prev=null,prevCid=null;cid=String(cid);for(var i=0,len=chapList.length;i<len;i++){var chap=chapList[i];if(String(chap.cid)===cid){prevCid=prev&&prev.cid;break}prev=chap}return prevCid},getNextChapID:function(_chapOrCid){var data=this,chapList=data.chapList,cid=typeof _chapOrCid==="object"?_chapOrCid.cid:_chapOrCid,next=null,nextCid=null;cid=String(cid);for(var i=0,len=
chapList.length;i<len;i++){var chap=chapList[i];if(String(chap.cid)===cid){next=chapList[i+1];nextCid=next&&next.cid;break}}return nextCid}},setInitData:function(raw,initChap,chapList){var self=this;var data=self.decode(raw),comic=data["comic"]||{},id=comic["id"]|0,title=comic["title"]||"...",artistName=comic["artistName"]||"...",coverUrl=comic["coverUrl"]||"",isFinished=comic["finishState"]===2||comic["finishState"]===true,chapData={};function ComicData(data){for(var p in data)if(data.hasOwnProperty(p))this[p]=
data[p]}ComicData.prototype=self.dataProto;var comicData=new ComicData({id:id,title:title,artistName:artistName,coverUrl:coverUrl,isFinished:isFinished,chapList:chapList,chapData:chapData,initChap:initChap});self.set(comicData);self._saveChapDetail(initChap);return initChap},loadChapDetail:function(cid,cb){var self=this,comicData=self.get(),id=comicData.id,chapData=comicData.chapData,chap=chapData[cid];if(chap)window.setTimeout(function(chap){cb&&cb(chap)},0);else self._loadChapDetail(id,cid,function(chap){cb&&
cb(chap)})},delChapDetail:function(cid){var self=this,comicData=self.get(),chapData=comicData.chapData;delete chapData[cid]},decode:function(raw,_nonce){var a=String.fromCharCode((1<<7)-31);var key=["d"+a+"t"+a,"mp"+"mvr"].join("-");var nonce=_nonce||window.nonce;raw=raw.split("");nonce=nonce.match(/\d+[a-zA-Z]+/g);var len=nonce.length;while(len--){var offset=parseInt(nonce[len])&255;var noise=nonce[len].replace(/\d+/g,"");raw.splice(offset,noise.length)}var _data=ek.encoding.decodeBase64(raw.join(""));
return JSON.parse(_data)},extractChap:function(data){var chapter=data["chapter"],picture=data["picture"]||[],cid=chapter["cid"]|0,cSeq=chapter["cSeq"]|0,cTitle=chapter["cTitle"]||"...",eid=chapter["eid"]||"",canRead=chapter["canRead"],vipStatus=chapter["vipStatus"];return{cid:cid,cSeq:cSeq,cTitle:cTitle,eid:eid,canRead:canRead,vipStatus:vipStatus,picList:picture,pgvPics:[],pgvReported:0}},_loadChapDetail:function(id,cid,cb){var self=this;ek.ajax({url:"/chapter/index/id/"+id+"/cid/"+cid,data:{style:"plain"},
rawResult:true,success:function(res){var raw=String(res).replace(/(^[ \t\r\n]+|[ \t\r\n]+$)/g,"").split("\n");var win={};(new Function("window",raw[1]))(win);var data=self.decode(raw[0],win["nonce"]),chap=self.extractChap(data);self._saveChapDetail(chap);cb&&cb(chap)}})},_saveChapDetail:function(chap){var self=this,page=self.page,comicData=self.get(),chapData=comicData.chapData,cid=chap.cid;chapData[cid]=chap;page.trigger("gotChapDetail",{chap:chap})}});module.exports=md_ComicData},{}],8:[function(require,
module,exports){var LocalHistory=require("/var/folders/sj/7pn_3chx3sdgly0m4ygc1vk80000gn/T/FC_BuildDir/h5_phone_v3/public/js/_local-history.js");var models=[];var md_ComicData=require("./comic-data.js");models.push(md_ComicData);var md_ReadProgress=require("./read-progress.js");models.push(md_ReadProgress);var md_CurrentChapter=new BIU.Model({name:"CurrentChapter",init:function(){var self=this;self.on("readNewChap",function(e){var page=self.page,comicData=page.get("ComicData"),cid=e.cid;self.set(comicData.getChapByID(cid))})}});
models.push(md_CurrentChapter);var md_NextChapter=new BIU.Model({name:"NextChapter",init:function(){var self=this;self.on("readNewChap",function(e){var page=self.page,comicData=page.get("ComicData"),cid=e.cid,nextCid=comicData.getNextChapID(cid);self.nextCid=nextCid;var chap=comicData.chapData[nextCid];chap&&self.set(chap)});self.on("gotChapDetail",function(e){var chap=e.chap;if(String(chap.cid)===String(self.nextCid))self.set(chap)})}});models.push(md_NextChapter);var md_PurchaseInfo=new BIU.Model({name:"PurchaseInfo",
load:function(id,cid){var self=this;ek.ajax({url:"/chapter/getPurchaseInfo",data:{id:id,cid:cid},success:function(res){self.set(res||{})}})}});models.push(md_PurchaseInfo);var md_EndChapterAds=new BIU.Model({name:"EndChapterAds",loaded:false,load:function(){var self=this,page=self.page,comicData=page.get("ComicData"),id=comicData.id,isFinished=comicData.isFinished;if(self.loaded)return;self.loaded=true;ek.ajax({url:"/chapter/showEndChapterAds/id/"+id,data:{isFinished:isFinished?"1":""},rawResult:true,
success:function(res){self.set(res)}})}});models.push(md_EndChapterAds);var md_BuyComic=new BIU.Model({name:"BuyComic",load:function(id,token,cb){var self=this;ek.ajax({url:"/chapter/buyComic",type:"POST",data:{id:id,tokenKey:token},success:function(res){res=res||{};var status=res.status;switch(status){case -99:Dialog.toast("\u767b\u5f55\u53ef\u80fd\u8fc7\u671f\u4e86\uff0c\u8bf7\u767b\u5f55\u540e\u518d\u8bd5",function(){pageAction.goLogin()});break;case 1:Dialog.toast("\u8d2d\u4e70\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");
break;case 2:res.msg=res.msg||"\u8d2d\u4e70\u6210\u529f";break;case 1004:Dialog.toast("\u62b1\u6b49\uff0c\u4f59\u989d\u4e0d\u8db3 >_<");break;default:Dialog.toast("\u672a\u77e5\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5");break}self.set(res);cb&&cb(res)}})}});models.push(md_BuyComic);var md_BuyChapter=new BIU.Model({name:"BuyChapter",load:function(id,cid,token,cb){var self=this;ek.ajax({url:"/chapter/buyChapter",type:"POST",data:{id:id,cid:cid,tokenKey:token},success:function(res){res=res||{};
var status=res.status;switch(status){case -99:Dialog.toast("\u767b\u5f55\u53ef\u80fd\u8fc7\u671f\u4e86\uff0c\u8bf7\u767b\u5f55\u540e\u518d\u8bd5",function(){pageAction.goLogin()});break;case 1:Dialog.toast("\u8d2d\u4e70\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5");break;case 2:res.msg=res.msg||"\u8d2d\u4e70\u6210\u529f";break;case 1004:Dialog.toast("\u62b1\u6b49\uff0c\u4f59\u989d\u4e0d\u8db3 >_<");break;default:Dialog.toast("\u672a\u77e5\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5");break}self.set(res);
cb&&cb(res)}})}});models.push(md_BuyChapter);var md_SaveReadRecord=new BIU.Model({name:"SaveReadRecord",lastRecord:null,load:function(id,cid,seq,cur){var self=this;if(!id||!cid||!seq||!cur)return;var data={id:id,cid:cid,seqno:seq,offset:cur};var thisRecord=JSON.stringify(data);if(thisRecord===this.lastRecord)return;this.lastRecord=thisRecord;ek.ajax({url:"/chapter/saveReadRecord",type:"POST",data:data,success:function(res){res=res||{};res.cid=cid;res.seq=seq;self.set(res)}})}});models.push(md_SaveReadRecord);
var md_SetPgvCount=new BIU.Model({name:"SetPgvCount",init:function(){var self=this,pgvCount=0,reportedPgvCount=0,reportIntv=5;self.on("comicPicLoaded",function(e){var page=self.page,comicData=page.get("ComicData"),chap=comicData.chapData[e.cid],eid=chap.eid;ek.ping.reportVisit(ek.ping.getVirtualUrl());typeof tryReportCooperationVisit=="function"&&tryReportCooperationVisit();pgvCount++;if(pgvCount-reportedPgvCount>=reportIntv||e.loadedPicCount==e.picCount){self.load(eid,pgvCount-reportedPgvCount);
reportedPgvCount=pgvCount;self.extraLoad()}})},load:function(eid,pgv){ek.ajax({url:"/chapter/setPgvCount",type:"POST",data:{client:ek.clientType,eid:eid,pgv:pgv}})},extraLoad:function(){}});models.push(md_SetPgvCount);var md_UserInfo=new BIU.Model({name:"UserInfo",load:function(id,cb){var that=this;ek.ajax({url:"/comic/getUserInfo",data:{id:id},success:function(res){that.set(res);cb&&cb(res)}})}});models.push(md_UserInfo);var md_CollectComic=new BIU.Model({name:"CollectComic",load:function(id,token,
cb){var self=this;ek.ajax({url:"/Bookshelf/addCollection",data:{"id":id,"tokenKey":token},success:function(res){self.set(res);cb&&cb(res)}})},autoCollect:function(cb){var self=this,page=self.page,comicData=page.get("ComicData"),comicId=comicData.id;page.load("UserInfo",comicId,function(res){var status=res&&res.status,data=res&&res.data,isColl=data&&data["is_coll"],token=data&&data["token"];if(status===2&&!isColl)self.load(comicId,token,function(res){cb&&cb(res)});else cb&&cb(res)})}});models.push(md_CollectComic);
var md_LocalHistory=new LocalHistory({name:"LocalHistory",listen:{"ReadProgress":function(progress){var self=this,page=self.page,id=page.comicId,cid=progress.cid,cur=progress.cur;self.saveChapterProgress(id,cid,cur)},"SaveReadRecord":function(res){var self=this,page=self.page,status=res&&res.status;if(status===-99){var comicData=page.get("ComicData"),id=comicData.id,cid=res.cid,seq=res.seq,title=comicData.title||"\u672a\u77e5",artist=comicData.artistName||"\u672a\u77e5",cover=comicData.coverUrl;self.saveComicRecord(id,
seq,cid,title,artist,cover)}else if(self.sort().length)self.sync()}}});models.push(md_LocalHistory);module.exports=models},{"./comic-data.js":7,"./read-progress.js":9,"/var/folders/sj/7pn_3chx3sdgly0m4ygc1vk80000gn/T/FC_BuildDir/h5_phone_v3/public/js/_local-history.js":19}],9:[function(require,module,exports){var md_ReadProgress=new BIU.Model({name:"ReadProgress",progress:{cid:null,seq:null,cur:1,total:1,toString:function(){var self=this,seq=self.seq,cur=self.cur,total=self.total;return"\u7b2c"+seq+
"\u8bdd - "+cur+"/"+total}},checkIfReadNewChap:function(){var self=this,page=self.page,progress=self.progress,id=page.comicId,cid=progress.cid,seq=progress.seq,lastCid=progress.lastCid,cur=progress.cur,total=progress.total,changed=lastCid!==cid;if(changed)page.trigger("readNewChap",{id:id,cid:cid,seq:seq,cur:cur,total:total})},load:function(cid,seq,cur,total){var self=this,progress=self.progress,changed=false;if(cur<1)cur=1;if(total<1)total=1;if(progress.cid!==cid||progress.seq!==seq||progress.cur!==
cur)changed=true;if(changed){progress.lastCid=progress.cid;progress.cid=cid;progress.seq=seq;progress.cur=cur;progress.total=total;self.checkIfReadNewChap();self.set(progress)}}});module.exports=md_ReadProgress},{}],10:[function(require,module,exports){module.exports=BasePicListManager;function BasePicListManager(opts){for(var n in opts)if(opts.hasOwnProperty(n))this[n]=opts[n]}BasePicListManager.prototype={onChapListBuilt:function(){throw new Error("\u8bf7\u5728\u5b50\u7c7b\u4e2d\u5b9e\u73b0\u8be5\u72b6\u6001\u7684\u56de\u8c03");
},onPicLoadOK:function(){throw new Error("\u8bf7\u5728\u5b50\u7c7b\u4e2d\u5b9e\u73b0\u8be5\u72b6\u6001\u7684\u56de\u8c03");},loadNearbyImages:function(){throw new Error("\u8bf7\u5728\u5b50\u7c7b\u4e2d\u5b9e\u73b0\u8be5\u72b6\u6001\u7684\u56de\u8c03");},map:{},lastBuiltCid:null,picCount:0,loadedPicCount:0,picLoadTimeout:1E4,waitingPicQueue:[],loadingPicQueue:[],findChapList:function(cid){var self=this,key=String(cid&&cid.cid||cid);return self.map[key]},hasChapList:function(cid){var self=this;return self.findChapList(cid)?
true:false},hasPrevList:function(cid){var self=this,list=self.findChapList(cid);return list&&list.attr("data-has-prev")?true:false},hasNextList:function(cid){var self=this,list=self.findChapList(cid);return list&&list.attr("data-has-next")?true:false},buildChapList:function(chap,_prevCid,_nextCid){var self=this,cid=chap.cid,render=self.listRender;if(this.hasChapList(cid))return;if(!render){var tpl=$("#tpl_comicPicList").html();render=self.listRender=template.compile(tpl)}var html=render(chap),$list=
$(html),$prevList=self.findChapList(_prevCid),$nextList=self.findChapList(_nextCid);if($prevList){$prevList.attr("data-has-next","1");$list.attr("data-has-prev","1");$prevList.after($list)}else if($nextList){$list.attr("data-has-next","1");$nextList.attr("data-has-prev","1");$nextList.before($list)}else $(".comic-pic-list-all").append($list);self.map[cid]=$list.filter("ul.comic-pic-list");self.lastBuiltCid=String(cid);self.picCount=$(".comic-pic-area img.comic-pic").length;self.onChapListBuilt(chap)},
removeChapList:function(chap){var self=this,cid=chap.cid,list=self.findChapList(cid);list.remove();delete self.map[String(cid)]},findPicItem:function(pid,loadState){return $("li.comic-pic-item.pic-"+loadState+'[data-pid="'+pid+'"]')},loadPic:function(img){var self=this,$img=$(img),src=$img.attr("data-src"),$item=$img.parents("li.comic-pic-item"),pid=$item.attr("data-pic")|0,loadingPicQueue=self.loadingPicQueue;var timeout=window.setTimeout(function(img){return function(){self.picLoadFailed(img)}}($img.get(0)),
self.picLoadTimeout);$img.off("load").on("load",function(){self.picLoadOK(this)}).off("error").on("error",function(){var img=this;window.setTimeout(function(){self.picLoadFailed(img)},1E3)});$item.removeClass("pic-unloaded").addClass("pic-loading").attr("data-timeout",String(timeout));$img.attr("src",src);if(loadingPicQueue.indexOf(pid)<0)loadingPicQueue.push(pid)},picLoadOK:function(img){var self=this,loadingPicQueue=self.loadingPicQueue,$img=$(img),src=$img.attr("data-src"),$item=$img.parents("li.comic-pic-item"),
$pad=$item.find("div.comic-pic-pad"),timeout=$item.attr("data-timeout"),pid=$item.attr("data-pic")|0,cid=$item.attr("data-cid")|0;timeout&&window.clearTimeout(Number(timeout));$item.attr("data-timeout","");$pad.empty();$item.removeClass("pic-loading").each(this._repaint);$item.addClass("pic-loaded");if(loadingPicQueue.indexOf(pid)>=0)loadingPicQueue.splice(loadingPicQueue.indexOf(pid),1);if(!loadingPicQueue.length)self._loadWaitingPicQueue();self.loadedPicCount++;var page=self.page;page&&page.trigger("comicPicLoaded",
{cid:cid,pid:pid,src:src,loadedPicCount:self.loadedPicCount,picCount:self.picCount});self.onPicLoadOK(img)},picLoadFailed:function(img){var self=this,$img=$(img),timeout=$img.attr("data-timeout"),$item=$img.parents("li.comic-pic-item"),$pad=$item.find("div.comic-pic-pad");timeout&&window.clearTimeout(Number(timeout));$img.attr("data-timeout","");if($item.is("pic-loaded"))return;$item.removeClass("pic-loading").addClass("pic-unloaded");$pad.empty().append($('<div class="err-info">\u55f7\u545c~\u56fe\u7247\u52a0\u8f7d\u5931\u8d25\u54af</div>').append($('<a class="reload-btn">\u91cd\u65b0\u52a0\u8f7d</a>').on("click",
function(e){var $item=$(this).parents("li.comic-pic-item"),$img=$item.find("img.comic-pic"),img=$img.get(0);img&&self.reloadPic(img);e.stopPropagation()})))},reloadPic:function(img){var self=this,$img=$(img),$item=$img.parents("li.comic-pic-item"),$pad=$item.find("div.comic-pic-pad"),src=$img.attr("data-src"),now=(new Date).getTime(),sp=src.indexOf("?")<0?"?":"&";src=src+sp+"_t="+now;$img.attr("src","");var $newImg=$img.clone();$img.before($newImg);$img.remove();$pad.empty();self.loadPic($newImg.attr("data-src",
src))},_loadWaitingPicQueue:function(){var self=this,waitingPicQueue=self.waitingPicQueue;self.waitingPicQueue=[];self._loadPicsOfIds(waitingPicQueue.reverse())},_loadPicsOfIds:function(ids){var self=this;for(var i=0,pid;pid=ids[i];i++){var $item=self.findPicItem(pid,"unloaded"),$img=$item.find("img.comic-pic");$img.length&&self.loadPic($img)}},_repaint:new Function("this.clientWidth")}},{}],11:[function(require,module,exports){var MessageAfterRefresh=function(opts){var self=this;self.key=opts.key};
MessageAfterRefresh.prototype={getMsg:function(){var self=this,key=self.key;try{var initMsg=window.localStorage.getItem(key);if(initMsg){window.localStorage.removeItem(key);return initMsg}}catch(e){console.log("\u8bfb\u5199 localStorage \u65f6\u51fa\u9519")}return null},putMsg:function(msg){var self=this,key=self.key;try{window.localStorage.setItem(key,msg)}catch(e){console.log("\u8bfb\u5199 localStorage \u65f6\u51fa\u9519")}}};module.exports=MessageAfterRefresh},{}],12:[function(require,module,exports){var ShareControl=
new BIU({init:function(){var self=this;self.$appDown=$('<a class="app-down-2"><img src="//gtimg.ac.qq.com/h5/chapter/images/app-guiding-2.png?v=d27bc5bd0a55622c"/></a>');self.on("readNewChap",function(e){var seq=e&&e.seq,total=e&&e.total;if(e.id=="632476")self.chapLimit=0;self.readingChapChanged(seq,total);self.isLoadLimit()});self.on("gotChapDetail",function(e){var chap=e&&e.chap;if(!chap.canRead){self.setChapLimit(self.getReadChapsCount());self.isLoadLimit()}});self.on("change:ReadProgress",function(e){var val=
e&&e.value,seq=val&&val.seq,cur=val&&val.cur,total=val&&val.total,cid=val&&val.cid;self.$appDown.on("click",function(){ek.ac.Client.CallUpComicViewChapter({"comic_id":self.page.comicId,"chapter_id":cid}).or(function(){ek.ping.downAppAndReport()})});self.checkBorderDialogShow(seq,cur,total)})},enabled:false,chapLimit:3,readChaps:[],enable:function(){var self=this,page=self.page;self.enabled=true;$("body").addClass("is-shared").append(self.$appDown);page.trigger("disableCtrlBtns");page.trigger("showTopBarTitle")},
disable:function(){var self=this,page=self.page;self.enabled=false;$("body").removeClass("is-shared").remove(self.$appDown);page.trigger("enableCtrlBtns");page.trigger("hideTopBarTitle")},setChapLimit:function(limit){this.chapLimit=limit},getReadChapsCount:function(){return this.readChaps.length},readingChapChanged:function(seq){if(!this.enabled)return;var readChaps=this.readChaps;if(readChaps.indexOf(seq)>=0)return;readChaps.push(seq);readChaps.sort()},isLoadLimit:function(){var self=this,page=self.page;
if(!this.enabled)return;var readChaps=this.readChaps,chapLimit=this.chapLimit,loadLimited=readChaps.length>=chapLimit;page.loadLimited=loadLimited;return loadLimited},checkBorderDialogShow:function(seq,cur,total){if(!this.enabled)return;var self=this,page=self.page,comicId=page.comicId;var readChaps=this.readChaps,chapLimit=this.chapLimit;if(!chapLimit)return false;if(readChaps.length<chapLimit)return;readChaps.sort();var firstSeq=readChaps[0],lastSeq=readChaps[readChaps.length-1];if(seq==firstSeq&&
cur==1||seq==lastSeq&&cur==total){var dialog2=new Dialog({title:'<i class="small-icon"></i>\u817e\u8baf\u52a8\u6f2bAPP',prop:{skin:"light-salmon",cover:true,closeBtn:true,lock:true},content:['<em class="em">\u66f4\u5feb\u66f4\u65b0\u3001\u5185\u5bb9\u66f4\u5168\u3001Q\u5e01\u6d3b\u52a8\u66f4\u591a</em>',"\u5b89\u88c5\u817e\u8baf\u52a8\u6f2bAPP\uff0c\u5373\u4eab\u6240\u6709\uff01",new PileDialogRow({content:[{text:"\u5b89\u88c5\u4eab\u798f\u5229",style:{width:"10rem","border-radius":"20rem",margin:"0 auto",
"font-size":"0.85rem"},click:function(){ek.ping.reportClick("h5_v3_app_down.box_free.down_app");var comicId=page.comicId,cid=md_ComicData.get().initChap.cid;ek.ac.Client.CallUpComicViewChapter({"comic_id":comicId,"chapter_id":cid}).or(function(){var appUrl=ek.isAndroid?"http://m.ac.qq.com/apkSet/qqcomic_android_dm10006.apk":ek.isIOS?"https://itunes.apple.com/app/apple-store/id569387346?pt=604140&ct=h5zhuzhan6&mt=8":null;ek.ping.downAppAndReport(appUrl)})}}]})]});dialog2.on("open",function(){ek.ping.reportClick("h5_v3_app_down.box_free.load")});
dialog2.on("close",function(){ek.ping.reportClick("h5_v3_app_down.box_free.read")});dialog2.open()}}});module.exports=ShareControl},{}],13:[function(require,module,exports){var viewModeHelper={KEY:"view_mode",HINT_KEY:"view_mode_hint",MODES:{SCROLL:"scroll",SWIPE:"swipe"},defaultMode:"scroll",getCurrentMode:function(){return ek.cookie.getCookie(this.KEY)||this.defaultMode},changeViewMode:function(modeName,doNotReload,doNotHint){if(!this.isValid(modeName))throw new Error("\u975e\u53ef\u7528\u7684\u6d4f\u89c8\u6a21\u5f0f");
ek.cookie.setCookie(this.KEY,modeName,365*24*60,"m.ac.qq.com","/");!doNotHint&&ek.cookie.setCookie(this.HINT_KEY,"1",null,"m.ac.qq.com","/");if(doNotReload)this.checkHint();else window.location.reload()},isValid:function(modeName){var ms=this.MODES;for(var mn in ms)if(ms.hasOwnProperty(mn)&&ms[mn]===modeName)return true;return false},checkHint:function(){var self=this,hint=ek.cookie.getCookie(this.HINT_KEY);if(!hint)return;ek.cookie.setCookie(this.HINT_KEY,"",null,"m.ac.qq.com","/");self.showHint();
window.setTimeout(function(){self.hideHint()},1E3)},showHint:function(){var self=this,mode=self.getCurrentMode(),repaint=new Function("this.clientWidth");$(".view-mode-hint").addClass(mode).each(repaint).addClass("show")},hideHint:function(){var self=this,mode=self.getCurrentMode(),repaint=new Function("this.clientWidth");$(".view-mode-hint").removeClass("show").each(repaint);window.setTimeout(function(){$(".view-mode-hint").removeClass(mode)},500)}};module.exports=viewModeHelper},{}],14:[function(require,
module,exports){var BaseComicPicArea=BIU.View.extend({loadRange:{up:2,down:3},pagePicLimit:100,screenSize:{},init:function(){var self=this;self.on("gotNewPicList",function(e){var chap=e&&e.chap,_prevCid=e&&e.prevCid,_nextCid=e&&e.nextCid;self.tryBuildList(chap,_prevCid,_nextCid)});self.on("jumpToPage",function(e){var page=self.page,cur=e.pageIndex,progress=page&&page.get("ReadProgress"),cid=progress&&progress.cid;self&&self.locateTo(cid,cur)});self.on("enableCtrlBtns","enableCtrlBtns");self.on("disableCtrlBtns",
"disableCtrlBtns");window.addEventListener("resize",function(){self.cacheScreenSize()});self.cacheScreenSize()},pageReady:function(){var self=this;self.picListManager.page=self.page},events:{"click .nav-ctrl-btn.prev":function(e){var href=$(".nav-ctrl-btn.prev").attr("href");ek.ping.reportClick(TAG_HEAD+"comic_pic_area.prev_chapter");e.preventDefault();!/^javascript:/.test(href)&&window.goPage(href,100)},"click .nav-ctrl-btn.next":function(e){var href=$(".nav-ctrl-btn.next").attr("href");ek.ping.reportClick(TAG_HEAD+
"comic_pic_area.next_chapter");e.preventDefault();var self=this,page=self.page,comicData=page.get("ComicData"),nextCid=self.nextCid,nextChap=comicData.chapData[nextCid];if(nextChap&&!nextChap.canRead)nextChap.buyChap&&nextChap.buyChap();else!/^javascript:/.test(href)&&window.goPage(href,100)}},listen:{"CurrentChapter":function(curChap){var self=this,page=self.page,comicData=page.get("ComicData"),id=comicData.id,prevCid=comicData.getPrevChapID(curChap.cid),nextCid=comicData.getNextChapID(curChap.cid),
nextChap=comicData.chapData[nextCid];self.curChap=curChap;self.nextCid=nextCid;self.setCtrlBtns(id,prevCid,nextCid,nextChap)},"NextChapter":function(nextChap){var self=this,page=self.page,comicData=page.get("ComicData"),id=comicData.id,curChap=self.curChap||comicData.initChap,prevCid=comicData.getPrevChapID(curChap.cid),nextCid=self.nextCid;self.setCtrlBtns(id,prevCid,nextCid,nextChap)},"ReadProgress":function(progress){var self=this,picListManager=self.picListManager,loadRange=self.loadRange;picListManager.loadNearbyImages(progress,
loadRange)}},cacheScreenSize:function(){var self=this,screenSize=self.screenSize;screenSize.width=document.documentElement.clientWidth;screenSize.height=document.documentElement.clientHeight},disableCtrlBtns:function(){$(".nav-ctrl-btn").attr("data-disabled","1")},enableCtrlBtns:function(){$(".nav-ctrl-btn").attr("data-disabled","")},setCtrlBtns:function(id,prevCid,nextCid,nextChap){var self=this,page=self.page;if(prevCid)$(".nav-ctrl-btn.prev").attr("href","/chapter/index/id/"+id+"/cid/"+prevCid+
"?pos=last").attr("data-can-read","2").html("\u70b9\u51fb\u52a0\u8f7d\u4e0a\u4e00\u7ae0\u8282");else $(".nav-ctrl-btn.prev").attr("href","javascript: void(0);").attr("data-can-read","1").html("\u524d\u9762\u6ca1\u6709\u66f4\u591a\u4e86~");if(nextCid)if(nextChap&&!nextChap.canRead)$(".nav-ctrl-btn.next").attr("href","javascript: void(0);").attr("data-can-read","1").html("\u5927\u4eba\uff0c\u60a8\u5c1a\u672a\u8d2d\u4e70\uff0c\u8bf7\u70b9\u51fb\u8d2d\u4e70");else $(".nav-ctrl-btn.next").attr("href",
"/chapter/index/id/"+id+"/cid/"+nextCid).attr("data-can-read","2").html("\u70b9\u51fb\u52a0\u8f7d\u4e0b\u4e00\u7ae0\u8282");else{$(".nav-ctrl-btn.next").attr("href","javascript: void(0);").attr("data-can-read","1").html("\u540e\u9762\u6ca1\u6709\u66f4\u591a\u4e86~");if(self.isEndChapAdsAvailable())$(".nav-ctrl-btn.next").hide()}},tryBuildList:function(chap,_prevCid,_nextCid){var self=this,picListManager=self.picListManager;if(picListManager.hasChapList(chap))picListManager.removeChapList(chap);picListManager.buildChapList(chap,
_prevCid,_nextCid);self.trigger("chapListBuilt",{chap:chap})},setReadProgress:function(progress){var self=this,page=self.page;page.load("ReadProgress",progress.cid,progress.seq,progress.cur,progress.total)},isEndChapAdsAvailable:function(){var ads=$(".end-chapter-ads"),isDisabled=ads.css("display")==="none";return!isDisabled}});module.exports=BaseComicPicArea},{}],15:[function(require,module,exports){var vw_BuyingDialog=new BIU.View({name:"vw_BuyingDialog",init:function(){var self=this;self.dialog=
self.createDialog();self.on("showBuy",function(e){if(pageAction.showBuy){pageAction.showBuy(e);return}self.showBuy(e)})},createDialog:function(){var self=this,dialog=new Dialog({title:"\u8d2d\u4e70\u4f5c\u54c1",prop:{skin:"light-salmon",cover:true,closeBtn:false,lock:true},content:["\u8d2d\u4e70\uff1a\u7b2c...\u8bdd ...",'\u4ef7\u683c\uff1a<em class="em">...</em> \u70b9\u5238 <i style="display:inline-block;width:24px;"></i> \u4f59\u989d\uff1a... \u70b9\u5238','\u5b89\u88c5\u817e\u8baf\u52a8\u6f2bAPP\uff0c\u66f4\u591a<em class="em">\u6298\u6263\u4f18\u60e0</em>\u7b49\u7740\u4f60\u54e6~',
{text:"\u5373\u4eab\u4f18\u60e0",click:function(){ek.ping.reportClick("h5_v3_app_down.box_charge.down_app");window.setTimeout(function(){var appUrl=ek.isAndroid?"http://m.ac.qq.com/apkSet/qqcomic_android_dm10006.apk":ek.isIOS?"https://itunes.apple.com/app/apple-store/id569387346?pt=604140&ct=h5zhuzhan6&mt=8":null;ek.ping.downAppAndReport(appUrl)},100)}},{text:"\u8d2d\u4e70",style:{backgroundColor:"gray",marginTop:"14px"},click:function(){}},""]});dialog.on("open",function(){ek.ping.reportClick("h5_v3_app_down.box_charge.load")});
dialog.on("close",function(e){var isBought=e&&e.bought,onNotBought=self.onNotBought;!isBought&&ek.ping.reportClick("h5_v3_app_down.box_charge.close");window.setTimeout(function(){!isBought&&onNotBought&&onNotBought()},100)});return dialog},showBuy:function(e){var self=this,page=self.page,dialog=self.dialog,id=e.id,cid=e.cid;self.buyChap=e.chap;self.onBought=e.onBought;self.onNotBought=e.onNotBought;Dialog.toast("\u8bf7\u7a0d\u5019\u2026",3E3);page.load("PurchaseInfo",id,cid);window.setTimeout(function(){dialog.setProp("closeBtn",
true)},300)},refreshDialog:function(type){var self=this,page=self.page,comicData=page.get("ComicData"),buyChap=self.buyChap,id=comicData.id,cid=buyChap["cid"],cSeq=buyChap["cSeq"],cTitle=buyChap["cTitle"],cCount=comicData["chapList"].length,purchaseInfo=self.purchaseInfo,isFinished=purchaseInfo["finishState"]===2,chapterPrice=purchaseInfo["chapterPrice"],comicPrice=purchaseInfo["comicPrice"],basePrice=type==="chapter"?chapterPrice:comicPrice,price=basePrice["price"],discountPrice=basePrice["discountPrice"]|
0,payPrice=(basePrice["payPrice"]||basePrice["price"])|0,comicPayPrice=(comicPrice["payPrice"]||comicPrice["price"])|0,proFlag=purchaseInfo["proFlag"],isVipUser=purchaseInfo["isVipUser"],balance=purchaseInfo["balance"]|0,tokenKey=purchaseInfo["token"],vipFree=purchaseInfo["vipFreeState"]===2,vipDiscount=parseFloat((payPrice*10/price).toFixed(1)),diff=price-payPrice,dialog=self.dialog;if(!dialog)return;var txtTitle=dialog.find(0),txtPrice=dialog.find(1),btnBuy=dialog.find(4),extraInfo=dialog.find(5);
self.buyId=id;self.buyCid=cid;self.buyToken=tokenKey;self.buyType=type;var buyTitle=type==="chapter"?"\u8d2d\u4e70\uff1a\u7b2c"+cSeq+"\u8bdd "+cTitle:"\u8d2d\u4e70\uff1a\u5171"+cCount+"\u8bdd",buyPrice='\u4ef7\u683c\uff1a<em class="em">'+payPrice+"</em> \u70b9\u5238",buyBalance="\u4f59\u989d\uff1a"+balance+" \u70b9\u5238",buyText="\u8d2d\u4e70",buyAction=function(){ek.ping.reportClick("h5_v3_app_down.box_charge.other");ek.ping.reportClick(TAG_HEAD+"buy.do_buy");self.doBuy()},extraText='<a class="link vip" style="display: none;" href="javascript: void(0);">\u5f00\u901aVIP\u5305\u6708 \u672c\u4e66'+
(vipFree?"\u514d\u8d39":"\u516b\u6298")+"\u770b &gt;</a>",extraAction=function(){ek.ping.reportClick("h5_v3_app_down.box_charge.other");ek.ping.reportClick(TAG_HEAD+"buy.vip");ek.pay.buyVip(window.location.href,"h5_chapter_"+id)};if(payPrice<price)buyPrice+=' <del class="weak del">'+price+"\u70b9\u5238</del>";if(isVipUser&&vipDiscount<10)buyPrice+=' <small class="weak small">'+vipDiscount+"\u6298\u540e\u62b5\u6263"+diff+"\u70b9\u5238</small>";if(balance<payPrice){buyBalance+='<small class="weak small">(\u70b9\u5238\u4e0d\u8db3)</small>';
buyText="\u5145\u503c\u8d2d\u4e70";buyAction=function(){ek.ping.reportClick("h5_v3_app_down.box_charge.other");ek.ping.reportClick(TAG_HEAD+"buy.charge");ek.pay.buyGoods(window.location.href)}}if(type==="chapter"&&isFinished){extraText='<a class="link vip" href="javascript: void(0);">\u6574\u4e66\u4ef7\uff1a'+comicPayPrice+"\u70b9\u5238/\u5171"+cCount+"\u8bdd \u8d2d\u4e70 &gt;</a>";extraAction=function(){ek.ping.reportClick("h5_v3_app_down.box_charge.other");ek.ping.reportClick(TAG_HEAD+"buy.go_buy_comic");
self.refreshDialog("comic")}}else if(isVipUser)extraInfo.hide();else extraInfo.show();txtTitle.setText(buyTitle);txtPrice.setText(buyPrice+'<i style="display:inline-block;width:24px;"></i>'+buyBalance);btnBuy.setText(buyText);$(btnBuy.dom).off("click").on("click",buyAction);extraInfo.setText(extraText);$(extraInfo.dom).off("click").on("click",extraAction);ek.ping.reportVisit("/chapter/index/id/"+id+"/cid/"+cid+"/dialog_buy_"+type)},doBuy:function(){var self=this,page=self.page,id=self.buyId,cid=self.buyCid,
buyToken=self.buyToken,type=self.buyType,onBought=self.onBought;if(self.isBuying)return;self.isBuying=true;if(type==="chapter"){Dialog.toast("\u8d2d\u4e70\u4e2d\uff0c\u8bf7\u7a0d\u5019\u2026",6E4);page.load("BuyChapter",id,cid,buyToken,_gotResult)}else{Dialog.toast("\u8d2d\u4e70\u4e2d\uff0c\u8bf7\u7a0d\u5019\u2026",6E4);page.load("BuyComic",id,buyToken,_gotResult)}ek.ping.reportClick(TAG_HEAD+"buy."+type);function _gotResult(res){var dialog=self.dialog,isBought=res.status===2;self.isBuying=false;
isBought&&onBought&&onBought(res);dialog&&dialog.close({bought:isBought})}},listen:{"PurchaseInfo":function(res){var self=this,dialog=self.dialog,status=res&&res.status,data=res&&res.data;Dialog.toastDialog.close();if(status===2){self.purchaseInfo=data;self.refreshDialog("chapter");dialog&&dialog.open()}else if(status===-99)window.setTimeout(function(){pageAction.goLogin()},300);else Dialog.toast("\u7f51\u7edc\u5f02\u5e38\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5")}}});module.exports=vw_BuyingDialog},{}],
16:[function(require,module,exports){var vw_EndChapterAds=new BIU.View({name:"vw_EndChapterAds",events:{"click .end-chapter-ads":function(e){var self=this,target=e&&e.target,btnCollect=$(target).closest(".control-btn.collect")[0],btnComment=$(target).closest(".control-btn.comment")[0],comicLink=$(target).closest(".list-recommend .comic-link")[0];if(btnCollect){var isCollected=$(btnCollect).find(".icon").is(".active");ek.ping.reportClick(TAG_HEAD+"end_info_collect."+(isCollected?"collected":"not_collected"));
!isCollected&&self.collectComic()}else if(btnComment)ek.ping.reportClick(TAG_HEAD+"end_info_comment");else if(comicLink){var id=comicLink.getAttribute("data-id");ek.ping.reportClick(TAG_HEAD_RECOMMEND+"chapter."+id)}}},listen:{"ComicData":function(data){var self=this,comicId=data.id,isFinished=data.isFinished;self.comicId=comicId;self.isFinished=isFinished},"EndChapterAds":function(data){return;var self=this,page=self.page,isFinished=self.isFinished;$(".end-chapter-ads").html(data).addClass("loaded");
if(isFinished)$(".end-chapter-ads .info-text").html("\u597d\u5389\u5bb3\uff01\u5168\u90e8\u8bfb\u5b8c\u4e86\uff01");var recommend=new RecommendMod({adPos:window.endChapAdPos||912,sum:3,comicId:page.comicId,listSelector:".list-recommend",templateSelector:'[data-tpl-name="recommend-list"]'});recommend.startProcess()}},collectComic:function(){var self=this,page=self.page,comicId=self.comicId;page.load("UserInfo",comicId,function(res){var status=res&&res.status,data=res&&res.data,isColl=data&&data["is_coll"],
token=data&&data["token"];if(status===2&&!isColl)page.load("CollectComic",comicId,token,function(res){cb&&cb(res)});else cb&&cb(res)});var cb=function(res){var status=res&&res.status,msg=res&&res.msg;if(status===2){$(".control-btn.collect .icon").addClass("active");$(".control-btn.collect .text").html("\u5df2\u5728\u4e66\u67b6");Dialog.toast(msg||"\u6536\u85cf\u6210\u529f")}else if(status===-99)pageAction.goLogin();else Dialog.toast(msg||">_< \u6536\u85cf\u5931\u8d25\u4e86\uff01\u8bf7\u7a0d\u5019\u91cd\u8bd5")}}});
module.exports=vw_EndChapterAds},{}],17:[function(require,module,exports){var viewModeHelper=require("../other/view-mode-helper.js");var FloatBarView=BIU.View.extend({init:function(){this.on("toggleFloatBar","toggle");this.on("showFloatBar","show");this.on("hideFloatBar","hide");this.on("enableFloatBar","enable");this.on("disableFloatBar","disable");this.on("clickMainArea",function(){this.toggle();var showingState=this.isShowing()?"show":"hide";ek.ping.reportClick(TAG_HEAD+"click_main_area."+showingState+
"_float_bars")});this.on("clickSideArea",function(){if(this.isShowing()){this.hide();var showingState=this.isShowing()?"show":"hide";ek.ping.reportClick(TAG_HEAD+"click_side_area."+showingState+"_float_bars")}})},toggle:function(){var self=this;if($(self.barSelector).hasClass("hidden"))self.show();else self.hide()},isShowing:function(){var self=this;return!$(self.barSelector).hasClass("hidden")},show:function(){var self=this,page=self.page;if(self.disabled)return;$(self.barSelector).removeClass("hidden");
self.resetHideTimeout(2500);page.trigger("floatBarShowed")},hide:function(){var self=this,page=self.page;if(self.disabled||$(self.barSelector).hasClass("hidden"))return;$(self.barSelector).addClass("hidden");self.clearHideTimeout();page.trigger("floatBarHidden")},resetHideTimeout:function(time){var self=this;self.clearHideTimeout();self.hideTimeout=window.setTimeout(function(){self.hide()},time)},clearHideTimeout:function(){var self=this;self.hideTimeout&&window.clearTimeout(self.hideTimeout);self.hideTimeout=
null},enable:function(){var self=this;self.disabled=false;$(self.barSelector).show()},disable:function(){var self=this;self.disabled=true;$(self.barSelector).hide()},pageReady:function(){var self=this;self.show()}});var vw_FloatBars=[new FloatBarView({name:"vw_FloatBarTop",barSelector:".float-bar.top",init:function(){var self=this;self.on("floatBarHidden",function(){$(".float-bar-menu.top-right").addClass("hidden")});self.on("showTopBarTitle","showComicTitle");self.on("hideTopBarTitle","hideComicTitle")},
events:{"click .float-bar-btn.back":function(){ek.ping.reportClick(TAG_HEAD+"float_bars.back");window.setTimeout(function(){pageAction.goBack()},100)},"click .float-bar-btn.home":function(e){var btn=$(e.target).closest(".float-bar-btn")[0],href=btn.getAttribute("href");ek.ping.reportClick(TAG_HEAD+"float_bars.index");e.preventDefault();window.setTimeout(function(){window.location.href=href},100)},"click .float-bar-btn.bookshelf":function(e){var btn=$(e.target).closest(".float-bar-btn")[0],href=btn.getAttribute("href");
ek.ping.reportClick(TAG_HEAD+"float_bars.bookshelf");e.preventDefault();window.setTimeout(function(){window.location.href=href},100)},"click .float-bar-menu-btn.share":function(){var self=this,page=self.page;page&&page.trigger("hideFloatBar");page&&page.trigger("showShare");ek.ping.reportClick(TAG_HEAD+"float_bars.share")},"click .float-bar-menu-btn.comment-list":function(){ek.ping.reportClick(TAG_HEAD+"float_bars.comment_list")},"click .float-bar-btn.more":function(){var self=this,page=self.page,
menu=$(".float-bar-menu.top-right");menu.toggleClass("hidden");page.trigger("showFloatBar");var status=menu.hasClass("hidden")?"hide":"show";ek.ping.reportClick(TAG_HEAD+"float_bars."+status+"_more")}},listen:{"ReadProgress":function(progress){$(".float-bar.top .float-bar-title .progress").html(progress.toString())}},showComicTitle:function(){$(".float-bar.top .float-bar-title .title").show()},hideComicTitle:function(){$(".float-bar.top .float-bar-title .title").hide()}}),new FloatBarView({name:"vw_FloatBarBottom",
barSelector:".float-bar.bottom",init:function(){var viewMode=viewModeHelper.getCurrentMode();$(".float-bar-btn.view-mode").addClass(viewMode)},events:{"click .float-bar-btn.chapter-list":function(){ek.ping.reportClick(TAG_HEAD+"float_bars.chapter_list")},"click .float-bar-btn.view-mode":function(){var viewMode=viewModeHelper.getCurrentMode(),newMode=viewMode===viewModeHelper.MODES.SCROLL?viewModeHelper.MODES.SWIPE:viewModeHelper.MODES.SCROLL;ek.ping.reportClick(TAG_HEAD+"float_bars.change_to_"+newMode+
"_mode");$(".comic-pic-list-loading").show().offset();viewModeHelper.changeViewMode(newMode)},"click .float-bar-btn.download":function(e){var self=this,page=self.page,btn=$(e.target).closest(".float-bar-btn")[0],androidUrl=page.appUrl["android_btn"],iosUrl=page.appUrl["ios_btn"];ek.ping.reportClick(TAG_HEAD+"float_bars.show_download");var comicId=page.comicId;ek.appScheme.detail(comicId).or(function(){var appUrl=ek.isAndroid?androidUrl:ek.isIOS?iosUrl:null;ek.ping.downAppAndReport(appUrl)})},"click .float-bar-btn.prev-chapter":function(e){var href=
$(".float-bar-btn.prev-chapter").attr("href");ek.ping.reportClick(TAG_HEAD+"float_bars.prev_chapter");e.preventDefault();!/^javascript:/.test(href)&&window.goPage(href,100)},"click .float-bar-btn.next-chapter":function(e){var href=$(".float-bar-btn.next-chapter").attr("href");ek.ping.reportClick(TAG_HEAD+"float_bars.next_chapter");e.preventDefault();!/^javascript:/.test(href)&&window.goPage(href,100)}},listen:{"CurrentChapter":function(curChap){var self=this,page=self.page,comicData=page.get("ComicData"),
isFinished=comicData.isFinished,id=comicData.id,cid=curChap.cid,prevCid=comicData.getPrevChapID(cid),nextCid=comicData.getNextChapID(cid);if(prevCid)$(".float-bar-btn.prev-chapter").attr("href","/chapter/index/id/"+id+"/cid/"+prevCid).off("click");else $(".float-bar-btn.prev-chapter").attr("href","javascript: void(0);").on("click",function(){Dialog.toast(">_< \u5df2\u7ecf\u662f\u7b2c\u4e00\u8bdd\u4e86~")});if(nextCid)$(".float-bar-btn.next-chapter").attr("href","/chapter/index/id/"+id+"/cid/"+nextCid).off("click");
else $(".float-bar-btn.next-chapter").attr("href","javascript: void(0);").on("click",function(){Dialog.toast(isFinished?"\u5df2\u5b8c\u7ed3\uff0c\u3010\u65b0\u4f5c\u915d\u917f\u4e2d...\u656c\u8bf7\u671f\u5f85\u3011":">_< \u6ca1\u6709\u4e0b\u4e00\u8bdd\u4e86\u54e6\uff0c\u671f\u5f85\u4f5c\u8005\u5927\u5927\u7684\u66f4\u65b0\u5427~")})}},pageReady:function(){var self=this;self.show();initUlink($(".float-bar-btn.download"),4093,"CallUpComicDownload?comic_id="+self.page.comicId,{"position":"relative"})}})];
module.exports=vw_FloatBars},{"../other/view-mode-helper.js":13}],18:[function(require,module,exports){var vw_ProgressBox=new BIU.View({name:"ProgressBox",init:function(){this.on("floatBarShowed",function(){$(".progress-box").addClass("out")});this.on("floatBarHidden",function(){$(".progress-box").removeClass("out")})},listen:{"ReadProgress":function(progress){var seq=(progress&&progress.seq)|0,cur=(progress&&progress.cur)|0,total=(progress&&progress.total)|0;$(".progress-box").html(seq+"\u8bdd "+
cur+"/"+total)}}});module.exports=vw_ProgressBox},{}],19:[function(require,module,exports){(function(){var LS={get:function(key){try{return window.localStorage?window.localStorage.getItem(key):false}catch(e){console.log("\u8bfb\u53d6 LocalStorage \u5f02\u5e38\uff1a",e);return false}},set:function(key,data){try{return window.localStorage?window.localStorage.setItem(key,data):false}catch(e){console.log("\u5199\u5165 LocalStorage \u5f02\u5e38\uff1a",e);return false}}};var LocalHistory=BIU.Model.extend({init:function(){var self=
this;self.read()},clear:function(exceptIds){var self=this,data=self.dataComic,newList=[];exceptIds=exceptIds||[];data.forEach(function(d){if(exceptIds.indexOf(String(d.id))>=0)newList.push(d)});self.dataComic=newList;self.save()},read:function(){var self=this,raw=LS.get(self.lsKey)||"[]",data=JSON.parse(raw);if(Object.prototype.toString.apply(data)!=="[object Array]")self.clear();self.dataComic=data;raw=LS.get(self.lsKey+"_CHAPTER")||"{}";data=JSON.parse(raw);self.dataChapter=data;return true},save:function(){var self=
this,data=self.dataComic;if(!data)return false;self.clean();self.trigger("onSave");var raw=JSON.stringify(data),res=LS.set(self.lsKey,raw);data=self.dataChapter;raw=JSON.stringify(data);return LS.set(self.lsKey+"_CHAPTER",raw)&&res},sort:function(){var self=this,data=self.dataComic;return data.sort(function(a,b){return-(a.time-b.time)})},clean:function(){var self=this,data=self.dataComic;if(data.length<self.limit)return;var list=self.sort(),ids=[];for(var i=list.length-self.limit,l=list.length;i<
l;i++)ids.push(list[i]);return self.deleteComicRecord(ids)},lsKey:"MAC_LOCAL_HISTORY",limit:50,loadComicRecord:function(id){var self=this,data=self.dataComic;id=String(id);for(var i=0,d;d=data[i];i++)if(String(d.id)==id)return d;return null},saveComicRecord:function(id,seq,cid,title,artist,cover){var self=this,data=self.dataComic,d=self.loadComicRecord(id),oldTitle=d&&d.title,oldArtist=d&&d.artist,oldCover=d&&d.cover;if(!d){d={};data.push(d)}d.time=(new Date).getTime();d.id=id;d.seq=seq;d.cid=cid;
d.title=title||oldTitle||"..";d.artist=artist||oldArtist||"..";d.cover=cover||oldCover||"";self.save();return true},deleteComicRecord:function(ids){var self=this,data=self.dataComic;if(!ids.length)ids=[ids];ids.forEach(function(id){var deleted=self.loadComicRecord(id),pos=data.indexOf(deleted);if(pos<0)return;data.splice(pos,1)});self.save();return true},sync:function(cb){var self=this,data=self.dataComic;if(!data||!data.length)return;self._syncServerTime(function(timeSpan){self._uploadToServer(timeSpan,
function(res){var status=res&&res.status||0,data=res&&res.data||{},exceptIds=data["fail_ids"]||[];if(status==2){self.clear(exceptIds);cb&&cb(res)}else console.error("\u9605\u8bfb\u8bb0\u5f55\u540c\u6b65\u5931\u8d25: ",status)})})},_uploadToServer:function(timeSpan,cb){var self=this,data=self.dataComic,tmp=[],startTime=null;for(var id in data){var d=data[id],time=(d.time/1E3|0)+timeSpan;tmp.push(d.id+"-"+d.cid+"-"+d.seq+"-"+time);if(time<startTime||startTime===null)startTime=time}ek.ajax({url:"/Bookshelf/updateReadHistory",
type:"post",data:{startTime:startTime,history:tmp.join(",")},success:function(res){cb&&cb(res)}})},_syncServerTime:function(cb){ek.ajax({url:"/Ajax/getTimeStamp",type:"post",success:function(res){var status=res&&res.status||null,data=res&&res.data||{},stamp=data.stamp||0,localStamp=(new Date).getTime()/1E3|0;cb&&cb(status===2?stamp-localStamp:0)}})},loadChapterProgress:function(id,cid){var self=this,data=self.dataChapter,cs=data[id]||{},cur=cs[cid]||1;return cur},saveChapterProgress:function(id,cid,
cur){var self=this,data=self.dataChapter,cs=data[id]={};cs[cid]=cur;self.save()}});window.LocalHistory=LocalHistory;if(typeof module!="undefined"&&module.exports)module.exports=LocalHistory})()},{}],20:[function(require,module,exports){(function(){var templateText='\x3c!-- \u5206\u4eab\u83dc\u5355 --\x3e\r\n<ul class="share-menu">\r\n    <li class="item">\r\n        <a class="link qzone">\r\n            <i class="icon"></i>\r\n            <span class="text">QQ\u7a7a\u95f4</span>\r\n        </a>\r\n    </li>\r\n</ul>',
styleText="html {\n  font-size: 20px; }\n\nhtml {\n  font-size: 10px;\n  overflow-x: hidden; }\n  @media screen and (min-width: 320px) {\n    html {\n      font-size: 17px; } }\n  @media screen and (min-width: 360px) {\n    html {\n      font-size: 19px; } }\n  @media screen and (min-width: 375px) {\n    html {\n      font-size: 20px; } }\n  @media screen and (min-width: 414px) {\n    html {\n      font-size: 22px; } }\n\nbody {\n  font-size: 14px; }\n\n.share-menu {\n  font-size: 0; }\n  .share-menu .item {\n    display: inline-block;\n    margin-left: 1.75rem; }\n  .share-menu .link .icon {\n    display: block;\n    margin-top: -0.125rem; }\n  .share-menu .link .text {\n    display: block;\n    margin-top: 0.125rem;\n    color: #535252;\n    font-size: 0.625rem;\n    text-align: center; }\n  .share-menu .link.qzone .icon {\n    width: 2.95rem;\n    height: 2.95rem;\n    background-image: url('data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAA9lBMVEUAAAD4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT4sBT////968X5ujH957b//fr4sRf/+e35tyj4sx3//Pb+9+f6yV/5v0D4tSL+9eH5vTn//v3+7sv95rP82Y3714b6wkj+8tj83pr71H/96r/96Lr836D70XX6zGb6x1f5uzT+8NH84qf7zmv/+/H95K783Jb7z276xVFzc6gxAAAAKXRSTlMAB/P5GYjKmXn9Db727lRMwiLf1tG5tow6KSYKA1tW8aynnxGPoG1saQ4ufjsAAASpSURBVGje7dvpVtpAGAbgEGQrINa9Wndr+35gEnZBRBRldb3/m2mVtlkmycyE5FR7fH6qhzhLJm9mPpQPH/6xr1uL6dR6cjmvAmp+ObmeSi9ufVWitF1ILOXgIreUKGwrkVj4vpaDj9zajyMlZLGdbAZc8f1CLMyGJvIQlE8sKOH4fBiHhPi3z2G0NBWHpHhq3hbH0ioCUNNzjfHmCgJa2Qze1I0MAstsBGzwl1XMZfWLEsCuijmpu4q0BEKQkB3WA4RiX2qAP2URkuwniasmEZrkkcRVQ5QUbO92FqHKij2JDxCyg6B3TvT30SIisMhdEVVEQOWsk7FVRGLVf9nYQEQ2fJ+vGUjo0DVEZTZ9ungFElpERhOiVry7OQ0ZUyK6gLC0Z1rbg4Rxm4iqZYhSvXJdCjJu6cUVhKU88nAcEkoavdBKEBV3z8+HkHFFM1MIO3Qd2TgklKs0025BVHxh7pXigv7ogCGxZsTykNC8p78uISrP3rs7kNElUxHCdpjLZiGhYpDFM0RlmQmVgYRrsjqHqIxzUn2HBL1GNnWIOlHs1iBhQHY9HYLWHBk1DnH6GTk8QVDcnl4LkGqsU60CQYXAcbFpEOMCCBIilyCzGrOqJYhZsu3o5SCspZGLB4hRrfuEWxB3QwyZJXKLk8k7RVfn5K5WdNEHY5EToso3NC9jBEaaG2cGVXJon92c+nD8fW/MiTbrcNWakJPW63TrLR0u9KljllXgYl0xJeGu4tHRWu+hWx/rfn/b9ojuScW0DA/6LXnTJlPz4mX7XKvW4W5ZMe1xnnEM5vPH9nW61oCHPcWkwltdIx9ns89vGGQ1KcOLqpjg59IgT8XZ54+qZNWpwJvoZdE6Iw+Ps4G90ySeCyKdbJkuLO3OzHPMT0U6eQ/+Kh2PYWUnu8FZnPfYG8ib/ug6rOx/1CvB37JtueAatMnmajasTXv/95vgSNoWR75TtwEs9cimCZ51yTdba7NqvwewUSO7BnhSkrsHNWZY8XxPDkPwpOW23nRmWDHUAkS5RblQU6LftCef1boDni25CHfpGFbU74nV40c4ucA6pFfnZbPbW3e3kzbZaDo3sFolBF/ybnXYVS6vH6xL9lgqnheEQrk2gKvy6KJv0KsR/BUkX71OiarDko9R98Yguua9ekm+aE5IyJT3oml3Ag6DhJzD14nkJkKFxBicTQTJLZMWMardRp8YZfjIym4QPZPTaQnAsEYOz/CxI7sd9uSMFiO8aj62yWYAb/ltqc0/Ni9dmNmwUSSrK3jbkN7qtAWmmzGs7gxrvpDd2T2Ej76lf+twaF61zd/C06H8NnbP2r+shpk9KhKN5UabKs30W15zzuDlmpTXEYUKL016VavDU/PWP9eoC/IHMg36RXtsws/lxC/XpAMcP42IqNgChz6498w1K7EAh211qg0hoDxtd7mHbaxjROT4LR6kRndszLGLCOy+1ZKAKAog3nK5R0TFLXxHEZfyRF+4tPRJkRDbRyj2Y++hKC2kErz3U3D4a4CP5ymvPI69r2LSuUpn32Oh8IvP32TLot9zEbhcyfv/UOAv8HUGZs2P5ssbOSBnfnnjw4d/6yeD7MxtTIgeuwAAAABJRU5ErkJggg==');\n    background-size: 2.95rem 2.95rem;\n    background-repeat: no-repeat; }\n";
var style=document.createElement("STYLE");style.innerHTML=styleText;document.body.appendChild(style);var box=document.createElement("DIV");box.className="share-menu-box";box.style.display="none";box.innerHTML=templateText;document.body.appendChild(box);var ShareDialog=BIU.View.extend({init:function(){var self=this;$(function(){self.dialog=self.createDialog();self.on("showShare",function(){self.dialog&&self.dialog.open()})})},createDialog:function(){var dialog=new Dialog({title:"\u5206\u4eab",prop:{skin:"flat",
cover:true,closeBtn:false,lock:false},content:[$(".share-menu")[0],{text:"\u53d6\u6d88\u5206\u4eab",click:function(){var dialog=this.dialog();dialog.close()}}]});return dialog},events:{"click .share-menu .link.qzone":function(){ek.share.shareToQZone()}}});window.ShareDialog=ShareDialog;if(typeof module!="undefined"&&module.exports)module.exports=ShareDialog})()},{}],21:[function(require,module,exports){"browserify entry";var page=pg_ChapterIndex;var ShareDialog=require("../../public/js/_share-dialog.js");
window.TAG_HEAD=HOT_TAG_ROOT+"chapter.";window.TAG_HEAD_RECOMMEND=HOT_TAG_ROOT+"recommend.";var MessageAfterRefresh=require("./index/other/message-after-refresh.js"),messageAfterRefresh=new MessageAfterRefresh({key:"MAC_CHAPTER_INDEX_MSG"}),initMsg=messageAfterRefresh.getMsg();initMsg&&Dialog.toast(initMsg);var isShared=parseInt(ek.url.getQueryString("shared"))||/^[^_]+_share$/.test(ek.url.getQueryString("flag"))?true:false;page.on("gotInitViewModeAndPageIndex",function ev_gotInitViewModeAndPageIndex(e){var viewModeHelper=
require("./index/other/view-mode-helper.js"),viewMode=viewModeHelper.getCurrentMode(),viewModeInCookie=ek.cookie.getCookie(viewModeHelper.KEY),viewModeInUrl=ek.url.getQueryString("view_mode"),viewModeOfShared=isShared&&viewModeHelper.MODES.SCROLL,wantViewMode=e.initViewMode||0,isLast=e.initPageIndex==="last",pageIndex=isShared?"start":isLast?"last":parseInt(e.initPageIndex)||1;if(page.isLightComic==2)wantViewMode=viewModeHelper.MODES.SCROLL;if(!wantViewMode)wantViewMode=viewModeHelper.isValid(viewModeInUrl)?
viewModeInUrl:viewModeHelper.isValid(viewModeInCookie)?viewModeInCookie:null;if(wantViewMode!==viewMode&&viewModeHelper.isValid(wantViewMode)){viewModeHelper.changeViewMode(wantViewMode,true);viewMode=wantViewMode}viewModeHelper.checkHint();if(viewModeOfShared)viewMode=viewModeOfShared;$(".comic-pic-area").addClass(viewMode+"-mode");switch(viewMode){case viewModeHelper.MODES.SWIPE:vw_ComicPicArea=require("./index/_swipe-mode/view/comic-pic-area.js")();break;case viewModeHelper.MODES.SCROLL:vw_ComicPicArea=
require("./index/_scroll-mode/view/comic-pic-area.js")();break}page.addView(vw_ComicPicArea);page.pageReady();window.setTimeout(function(){page.initPageIndex=pageIndex;md_ComicData.setInitData(page.data,initChap,page.chapterInfo);if(pageIndex!=1&&pageIndex!="start"&&pageIndex!="last")PileDialog.toast("\u5df2\u7ecf\u4e3a\u4e3b\u4eba\u8df3\u5230\u4e0a\u6b21\u770b\u5230\u7684\u4f4d\u7f6e~ >\u2200<")},100)});page.on("gotChapDetail",function ev_gotChapDetail(e){var chap=e.chap,comicData=md_ComicData.get(),
initChap=comicData.initChap,isInitChap=String(initChap.cid)===String(chap.cid),prevCid=comicData.getPrevChapID(chap.cid),nextCid=comicData.getNextChapID(chap.cid),id=comicData.id;if(isShared&&id!="632476"&&(!nextCid||!chap.canRead)&&comicData.chapList.length>3&&isInitChap)window.location.href="https://m.ac.qq.com/Chapter/index/id/"+id+"/cid/"+comicData.chapList[0]["cid"];if(!chap.canRead){chap.buyChap=function(){var id=comicData.id,cid=chap.cid;page.trigger("showBuy",{id:id,cid:cid,chap:chap,onBought:function(res){var msg=
res.msg;page.trigger("chapBought",{msg:msg,chap:chap})},onNotBought:function(){isInitChap&&window.history.back()}})};if(isInitChap){page.trigger("gotNewPicList",{chap:chap,prevCid:prevCid,nextCid:nextCid});if(!isShared)chap.buyChap();initPageIndex=1}}else page.trigger("gotNewPicList",{chap:chap,prevCid:prevCid,nextCid:nextCid})});page.on("needChapDetail",function ev_needChapDetail(e){var self=this,cid=e.cid;if(self.loadingDetail||self.loadLimited)return;self.loadingDetail=true;md_ComicData.delChapDetail(cid);
md_ComicData.loadChapDetail(cid,function(){self.loadingDetail=false})});page.on("chapBought",function ev_chapBought(e){var chap=e.chap,msg=e.msg,comicData=md_ComicData.get(),initChap=comicData.initChap,isInitChap=String(initChap.cid)===String(chap.cid),vipStatus=chap.vipStatus;var _afterBought=function(){if(isInitChap){messageAfterRefresh.putMsg(msg);window.location.reload()}else{Dialog.toast(msg);page.trigger("needChapDetail",{cid:chap.cid})}};if(vipStatus===2){var md_CollectComic=page.find("CollectComic");
md_CollectComic.autoCollect(function(res){var status=res&&res.status,data=res&&res.data,isColl=data&&data["is_coll"];if(status==2&&!isColl)msg+="\uff0c\u8be5\u6f2b\u753b\u4e5f\u81ea\u52a8\u5e2e\u60a8\u6536\u85cf\u4e86\u54e6";_afterBought()})}else _afterBought()});page.on("change:ReadProgress",function ev_readProgressChange(e){var progress=e.value,readedComicInfo=md_ComicData.get(),comicTotal=readedComicInfo.chapList.length,readedChap=readedComicInfo.chapData,totalPic=0,count=0,_pageLimit=100;var comicId=
md_ComicData.get().id;var cid=progress.cid;for(var k in readedChap){totalPic+=readedChap[k].picList.length;if(readedChap.hasOwnProperty(k))count++}if(comicTotal>3&&comicTotal==progress.seq&&progress.total==progress.cur||count<3&&totalPic>_pageLimit&&progress.total==progress.cur){var dialog1=new Dialog({title:'<i class="small-icon"></i>\u817e\u8baf\u52a8\u6f2bAPP',prop:{skin:"light-salmon",cover:true,closeBtn:true,lock:true},content:['<em class="em">\u66f4\u5feb\u66f4\u65b0\u3001\u5185\u5bb9\u66f4\u5168\u3001Q\u5e01\u6d3b\u52a8\u66f4\u591a</em>',
"\u5b89\u88c5\u817e\u8baf\u52a8\u6f2bAPP\uff0c\u5373\u4eab\u6240\u6709\uff01",new PileDialogRow({content:[{text:"\u5b89\u88c5\u4eab\u798f\u5229",style:{width:"10rem","border-radius":"20rem",margin:"0 auto","font-size":"0.85rem"},click:function(){ek.ping.reportClick("h5_v3_app_down.box_free.down_app");var comicId=page.comicId,cid=md_ComicData.get().initChap.cid;ek.ac.Client.CallUpComicViewChapter({"comic_id":comicId,"chapter_id":cid}).or(function(){var appUrl=ek.isAndroid?"http://m.ac.qq.com/apkSet/qqcomic_android_dm10006.apk":
ek.isIOS?"https://itunes.apple.com/app/apple-store/id569387346?pt=604140&ct=h5zhuzhan6&mt=8":null;ek.ping.downAppAndReport(appUrl)})}}]})]});dialog1.on("open",function(){ek.ping.reportClick("h5_v3_app_down.box_free.load")});dialog1.on("close",function(){ek.ping.reportClick("h5_v3_app_down.box_free.read")});dialog1.open()}else $(".progress-box").css("display","block")});var vw_FloatBars=require("./index/view/float-bars.js"),vw_ProgressBox=require("./index/view/progress-box.js"),vw_BuyingDialog=require("./index/view/buying-dialog.js"),
vw_EndChapterAds=require("./index/view/end-chapter-ads.js"),vw_ComicPicArea=null;var vw_ShareDialog=new ShareDialog({name:"vw_ShareDialog"});var models=require("./index/model/models.js"),views=vw_FloatBars.concat([vw_EndChapterAds,vw_ProgressBox,vw_BuyingDialog,vw_ShareDialog]);page.addModel(models);page.addView(views);var md_ComicData=page.find("ComicData"),initData=md_ComicData.decode(page.data),initChap=md_ComicData.extractChap(initData);md_ComicData.initChap=initChap;(function init_blockCallback(){if(Number(ek.url.getQueryString("fromVipBlock"))==
1)Dialog.toast("\u5927\u5927\u5148\u4eab\u7528\u7b2c\u4e00\u8bdd\u5427\uff0c\u514d\u8d39\u7684\u54e6\uff01")})();(function init_shareProcess(){if(isShared){var ShareControl=require("./index/other/share-control.js");ShareControl.on("pageReady",function(){ShareControl.enable()});page.addChild(ShareControl)}else{page.on("readNewChap",function(e){var id=page.comicId,cid=e.cid,seq=e.seq,cur=e.cur;console.log(new Date);console.log("document.visibilityState: "+document["visibilityState"]);console.log("document.hidden: "+
document["hidden"]);if(document["visibilityState"]!="visible"||document.hidden)return;var url="/chapter/index/id/"+id+"/cid/"+cid;try{window.history.replaceState&&window.history.replaceState(null,"",url)}catch(e$0){console.error("replaceState \u66f4\u65b0 URL \u65f6\u51fa\u73b0\u5f02\u5e38\uff1a",e$0)}page.load("SaveReadRecord",id,cid,seq,cur)});page.on("change:ReadProgress",ek.func.debounce(function(e){var id=page.comicId,cid=e.value.cid,seq=e.value.seq,cur=e.value.cur;page.load("SaveReadRecord",
id,cid,seq,cur)},2500,page))}})();(function init_blockToApp(){var blocker=new Blocker({timeKey:"chapter"});var dialog=new Dialog({title:'<i class="small-icon"></i>\u817e\u8baf\u52a8\u6f2bAPP',prop:{skin:"light-salmon",cover:true,closeBtn:true,lock:true},content:['<em class="em">\u66f4\u5feb\u66f4\u65b0\u3001\u5185\u5bb9\u66f4\u5168\u3001Q\u5e01\u6d3b\u52a8\u66f4\u591a</em>',"\u5b89\u88c5\u817e\u8baf\u52a8\u6f2bAPP\uff0c\u5373\u4eab\u6240\u6709\uff01",new PileDialogRow({content:[{text:"\u5b89\u88c5\u4eab\u798f\u5229",
style:{width:"10rem","border-radius":"20rem",margin:"0 auto","font-size":"0.85rem"},click:function(){ek.ping.reportClick("h5_v3_app_down.box_free.down_app");var comicId=page.comicId,cid=md_ComicData.get().initChap.cid;ek.ac.Client.CallUpComicViewChapter({"comic_id":comicId,"chapter_id":cid}).or(function(){var appUrl=ek.isAndroid?"http://m.ac.qq.com/apkSet/qqcomic_android_dm10006.apk":ek.isIOS?"https://itunes.apple.com/app/apple-store/id569387346?pt=604140&ct=h5zhuzhan6&mt=8":null;ek.ping.downAppAndReport(appUrl)})}}]})]});
dialog.on("open",function(){ek.ping.reportClick("h5_v3_app_down.box_free.load")});dialog.on("close",function(){ek.ping.reportClick("h5_v3_app_down.box_free.read")});var READ_BLOCK_LIMIT=1;page.on("gotChapDetail",function(e){var self=this,count=self.loadDetailCount||0;var chap=e.chap,comicData=md_ComicData.get();var id=comicData.id,cid=chap.cid;count++;console.log("loadDetailCount: ",count);if(!isShared&&count>READ_BLOCK_LIMIT&&blocker.check()){blocker.rememberBlocked();dialog.open()}self.loadDetailCount=
count})})()},{"../../public/js/_share-dialog.js":20,"./index/_scroll-mode/view/comic-pic-area.js":3,"./index/_swipe-mode/view/comic-pic-area.js":6,"./index/model/models.js":8,"./index/other/message-after-refresh.js":11,"./index/other/share-control.js":12,"./index/other/view-mode-helper.js":13,"./index/view/buying-dialog.js":15,"./index/view/end-chapter-ads.js":16,"./index/view/float-bars.js":17,"./index/view/progress-box.js":18}]},{},[21]);
