(function(){var template='<section class="mod-load-more">\r\n    <div class="mlm-status-loading">\r\n        <div class="mlm-dots">\r\n            <span class="mlm-dot"></span>\r\n            <span class="mlm-dot"></span>\r\n            <span class="mlm-dot"></span>\r\n        </div>\r\n        <p class="mlm-info">\u563f\u54bb\u563f\u54bb\u52a0\u8f7d\u4e2d</p>\r\n    </div>\r\n    <div class="mlm-status-over">\r\n        \u5ba2\u5b98\uff0c\u4eba\u5bb6\u5df2\u7ecf\u6ca1\u6709\u90a3\u4e2a\u7684\u5566~~\r\n    </div>\r\n    <div class="mlm-status-again">\r\n        <a class="mlm-btn-again">\r\n            \u518d\u5237\u4e00\u6b21\uff01>_<\r\n        </a>\r\n    </div>\r\n</section>',
styles="html {\n  font-size: 20px; }\n\nhtml {\n  font-size: 10px;\n  overflow-x: hidden; }\n  @media screen and (min-width: 320px) {\n    html {\n      font-size: 17px; } }\n  @media screen and (min-width: 360px) {\n    html {\n      font-size: 19px; } }\n  @media screen and (min-width: 375px) {\n    html {\n      font-size: 20px; } }\n  @media screen and (min-width: 414px) {\n    html {\n      font-size: 22px; } }\n\nbody {\n  font-size: 14px; }\n\n.mod-load-more {\n  text-align: center;\n  padding-top: 0.95rem;\n  padding-bottom: 0.95rem;\n  color: #9a9a9a;\n  font-size: 0.6rem; }\n  .mod-load-more .mlm-status-loading .mlm-dots {\n    text-align: center;\n    display: inline-block; }\n    .mod-load-more .mlm-status-loading .mlm-dots span.mlm-dot {\n      display: inline-block;\n      vertical-align: middle;\n      width: 5px;\n      height: 5px;\n      background-color: #7a8090;\n      border-radius: 50%;\n      margin: 0 3px; }\n      .mod-load-more .mlm-status-loading .mlm-dots span.mlm-dot:nth-of-type(1) {\n        background-color: #7a8090;\n        -webkit-animation: mod-load-more_dot_move 1s ease-in infinite; }\n      .mod-load-more .mlm-status-loading .mlm-dots span.mlm-dot:nth-of-type(2) {\n        background-color: rgba(122, 128, 144, 0.6);\n        -webkit-animation: mod-load-more_dot_move 1s ease-in 0.3s infinite; }\n      .mod-load-more .mlm-status-loading .mlm-dots span.mlm-dot:nth-of-type(3) {\n        background-color: rgba(122, 128, 144, 0.3);\n        -webkit-animation: mod-load-more_dot_move 1s ease-in 0.7s infinite; }\n\n@-webkit-keyframes mod-load-more_dot_move {\n  0% {\n    opacity: 1; }\n  100% {\n    opacity: 0.5; } }\n  .mod-load-more .mlm-status-loading p.mlm-info {\n    display: inline-block;\n    vertical-align: middle; }\n  .mod-load-more .mlm-status-over {\n    display: none; }\n  .mod-load-more .mlm-status-again {\n    display: none;\n    width: 100%; }\n    .mod-load-more .mlm-status-again a.mlm-btn-again {\n      display: block;\n      margin: 0 auto;\n      width: 7.5rem;\n      height: 2.25rem;\n      background-color: #666;\n      color: white;\n      font-size: 0.75rem;\n      height: 2.25rem;\n      line-height: 2.25rem; }\n";
function LoadMore(para){var that=this;that.init(para)}LoadMore.prototype={"init":function(para){var that=this;para=para||{};if(!para.listElem)return;that.createStyles();that.listElem=para.listElem;that.scrollElem=para.scrollElem||document.body;that.scrollLimit=para.scrollLimit||300;that.pageIndex=para.pageIndex===undefined?1:para.pageIndex;that.pageSize=para.pageSize||10;that.onLoading=para.onLoading;that.onEnough=para.onEnough;that.onNotEnough=para.onNotEnough;that.itemUniqueAttr=para.itemUniqueAttr;
that.itemHashAttr=para.itemHashAttr;that.dom=$(template);that.dom.$status_loading=that.dom.find(".mlm-status-loading");that.dom.$status_over=that.dom.find(".mlm-status-over");$(that.listElem).after(that.dom);that.bindScroll()},"createStyles":function(){if(!LoadMore.styles){LoadMore.styles=$("<style></style>").html(styles);$("body").append(LoadMore.styles)}},"changeStatusToNormal":function(){var that=this;that.dom.hide();that.isLoading=false;that.isLoadOver=false},"changeStatusToLoading":function(){var that=
this;that.dom.show();that.dom.$status_loading.show();that.dom.$status_over.hide();that.isLoading=true;that.isLoadOver=true},"changeStatusToOver":function(){var that=this;that.dom.show();that.dom.$status_loading.hide();that.dom.$status_over.show();that.isLoading=false;that.isLoadOver=true},"bindScroll":function(){var that=this;var scrollElem=that.scrollElem,box=scrollElem==document.body?document.documentElement:scrollElem,tar=scrollElem==document.body?window:scrollElem,limit=that.scrollLimit;tar.addEventListener("scroll",
function(){var scrollTop=box.scrollTop||scrollElem.scrollTop||window.scrollY||window.pageYOffset;if(box.clientHeight+scrollTop>=scrollElem.scrollHeight-limit)that.onTouchLimit()})},"onTouchLimit":function(){var that=this;var callback=that.onLoading;if(!that.isLoadOver&&callback&&typeof callback=="function"&&!that.isLoading)if(callback.call(that)!==false)that.changeStatusToLoading()},"appendChild":function(children){var that=this,itemUniqueAttr=that.itemUniqueAttr,itemHashAttr=that.itemHashAttr;if(typeof children===
"string")children=children.replace(/(^\s+|\s+$)/g,"");if(!children){if(that.onNotEnough&&!that.onNotEnough(children)){that.changeStatusToNormal();return}that.changeStatusToOver();return}var $listElem=$(that.listElem),$children=$(children),childType=$children.attr("tagName");if(!childType||!childType.toLowerCase||childType.toLowerCase()!=="li"){$children=$children.filter("li");if(!$children.length)$children=$children.find("li")}$children.each(function(){if(itemUniqueAttr){var $item=$(this),attrValue=
$item.attr(itemUniqueAttr),$sameItem=$listElem.find("["+itemUniqueAttr+'="'+attrValue+'"]');if($sameItem&&$sameItem.length){if(!itemHashAttr||$item.attr(itemHashAttr)!==$sameItem.attr(itemHashAttr))$sameItem.replaceWith($item);return}}$listElem.append(this)});if($children.length)that.pageIndex++;if($children.length<that.pageSize){if(that.onNotEnough&&!that.onNotEnough(children)){that.changeStatusToNormal();return}that.changeStatusToOver()}else{if(that.onEnough&&!that.onEnough(children)){that.changeStatusToOver();
return}that.changeStatusToNormal()}}};window.LoadMore=LoadMore})();
(function(){var tpl='{{if commentList&&commentList.length>0 }}\r\n{{each commentList as value i}}\r\n<li class="mod-comment-item">\r\n    <div class="comment-item-head">\r\n        <div class="comment-item-head-layLeft">\r\n            <img class="comment-item-userHead" src="{{value.qq_head}}" alt="\u7528\u6237\u5934\u50cf"/>\r\n\r\n            <div class="comment-item-head-layBox">\r\n                <strong class="comment-item-userName">{{value.nick_name}}</strong>\r\n                <span class="comment-item-time">\r\n\r\n                    {{value.pub_time | dateFormat}}\r\n                </span>\r\n            </div>\r\n        </div>\r\n        <div class="comment-item-head-layRight">\r\n            <a class="comment-item-like unlike" data-commentId="{{value.comment_id}}">\r\n                <span class="iconfont unlike">\r\n                    &#xe61c;\r\n                </span>\r\n                <span class="iconfont liked">\r\n                    &#xe61b;\r\n                </span>\r\n                <span class="comment-item-like-count">\r\n                    {{value.good }}\r\n                </span>\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div class="comment-item-content">\r\n        <p>{{value.content }}</p>\r\n    </div>\r\n</li>\r\n{{/each}}\r\n{{/if}}';template.helper("dateFormat",
function(data){var date=new Date(data*1E3);var y=date.getFullYear();var m=date.getMonth()+1;var d=date.getDate();return y+"\u5e74"+m+"\u6708"+d+"\u65e5"});template.helper("decode",function(data){if(typeof data=="string")return data.replace(/</g,"&lt;");else return""});window.md_CommentLike=new BIU.Model({name:"md_CommentLike",load:function(comicId,commentId){var that=this;ek.ajax({url:"/comment/addCommentLike",data:{id:comicId,comment_id:commentId},success:function(res){that.set(res)}})}});window.md_CommentList=
new BIU.Model({name:"Model_Comment",load:function(id,pageIndex,pageSize){var that=this;ek.ajax({url:"/comment/getCommentList/id/"+id,data:{page:pageIndex,pageSize:pageSize},success:function(res){that.set(res)}})}});window.View_CommentList=BIU.View.extend({init:function(){var that=this;that.render=template.compile(tpl);that.loadMore=new LoadMore({listElem:$(that.listName),pageIndex:that.pageIndex||0,pageSize:that.pageSize||10,onLoading:function(){var page=that.page;if(!that.disabled)page.load("Model_Comment",
that.id,that.loadMore.pageIndex,that.loadMore.pageSize);else return false}})},pageReady:function(){var that=this;this.loadMore.onTouchLimit();this.bindEvent("click "+this.listName,function(e){that.clickProxy(e)})},clickProxy:function(e){var that=this;that.$target=$(e.target).closest(".comment-item-like");if(that.$target&&that.$target.hasClass("unlike")){var commentId=that.$target.attr("data-commentid");that.page.load("md_CommentLike",that.page.id,commentId)}},listen:{"Model_Comment":function(res){var that=
this;var tplStr=that.render(res.data);that.loadMore.appendChild(tplStr)},"md_CommentLike":function(res){var that=this;if(res.status==2){that.$target.removeClass("unlike").addClass("liked");var $count=that.$target.find(".comment-item-like-count");$count.html(Number($count.html())+1)}else if(res.status==-99)pageAction.goLogin();else PileDialog.alert(res.msg)}},"disable":function(){var that=this;that.disabled=true},"enable":function(){var that=this;that.disabled=false}})})();
(function(){var templateText='\x3c!-- \u5206\u4eab\u83dc\u5355 --\x3e\r\n<ul class="share-menu">\r\n    <li class="item">\r\n        <a class="link qzone">\r\n            <i class="icon"></i>\r\n            <span class="text">QQ\u7a7a\u95f4</span>\r\n        </a>\r\n    </li>\r\n</ul>',styleText="html {\n  font-size: 20px; }\n\nhtml {\n  font-size: 10px;\n  overflow-x: hidden; }\n  @media screen and (min-width: 320px) {\n    html {\n      font-size: 17px; } }\n  @media screen and (min-width: 360px) {\n    html {\n      font-size: 19px; } }\n  @media screen and (min-width: 375px) {\n    html {\n      font-size: 20px; } }\n  @media screen and (min-width: 414px) {\n    html {\n      font-size: 22px; } }\n\nbody {\n  font-size: 14px; }\n\n.share-menu {\n  font-size: 0; }\n  .share-menu .item {\n    display: inline-block;\n    margin-left: 1.75rem; }\n  .share-menu .link .icon {\n    display: block;\n    margin-top: -0.125rem; }\n  .share-menu .link .text {\n    display: block;\n    margin-top: 0.125rem;\n    color: #535252;\n    font-size: 0.625rem;\n    text-align: center; }\n  .share-menu .link.qzone .icon {\n    width: 2.95rem;\n    height: 2.95rem;\n    background-image: url('data:image/png;base64, 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');\n    background-size: 2.95rem 2.95rem;\n    background-repeat: no-repeat; }\n";
var style=document.createElement("STYLE");style.innerHTML=styleText;document.body.appendChild(style);var box=document.createElement("DIV");box.className="share-menu-box";box.style.display="none";box.innerHTML=templateText;document.body.appendChild(box);var ShareDialog=BIU.View.extend({init:function(){var self=this;$(function(){self.dialog=self.createDialog();self.on("showShare",function(){self.dialog&&self.dialog.open()})})},createDialog:function(){var dialog=new Dialog({title:"\u5206\u4eab",prop:{skin:"flat",
cover:true,closeBtn:false,lock:false},content:[$(".share-menu")[0],{text:"\u53d6\u6d88\u5206\u4eab",click:function(){var dialog=this.dialog();dialog.close()}}]});return dialog},events:{"click .share-menu .link.qzone":function(){ek.share.shareToQZone()}}});window.ShareDialog=ShareDialog;if(typeof module!="undefined"&&module.exports)module.exports=ShareDialog})();
(function(){var LS={get:function(key){try{return window.localStorage?window.localStorage.getItem(key):false}catch(e){console.log("\u8bfb\u53d6 LocalStorage \u5f02\u5e38\uff1a",e);return false}},set:function(key,data){try{return window.localStorage?window.localStorage.setItem(key,data):false}catch(e){console.log("\u5199\u5165 LocalStorage \u5f02\u5e38\uff1a",e);return false}}};var LocalHistory=BIU.Model.extend({init:function(){var self=this;self.read()},clear:function(exceptIds){var self=this,data=
self.dataComic,newList=[];exceptIds=exceptIds||[];data.forEach(function(d){if(exceptIds.indexOf(String(d.id))>=0)newList.push(d)});self.dataComic=newList;self.save()},read:function(){var self=this,raw=LS.get(self.lsKey)||"[]",data=JSON.parse(raw);if(Object.prototype.toString.apply(data)!=="[object Array]")self.clear();self.dataComic=data;raw=LS.get(self.lsKey+"_CHAPTER")||"{}";data=JSON.parse(raw);self.dataChapter=data;return true},save:function(){var self=this,data=self.dataComic;if(!data)return false;
self.clean();self.trigger("onSave");var raw=JSON.stringify(data),res=LS.set(self.lsKey,raw);data=self.dataChapter;raw=JSON.stringify(data);return LS.set(self.lsKey+"_CHAPTER",raw)&&res},sort:function(){var self=this,data=self.dataComic;return data.sort(function(a,b){return-(a.time-b.time)})},clean:function(){var self=this,data=self.dataComic;if(data.length<self.limit)return;var list=self.sort(),ids=[];for(var i=list.length-self.limit,l=list.length;i<l;i++)ids.push(list[i]);return self.deleteComicRecord(ids)},
lsKey:"MAC_LOCAL_HISTORY",limit:50,loadComicRecord:function(id){var self=this,data=self.dataComic;id=String(id);for(var i=0,d;d=data[i];i++)if(String(d.id)==id)return d;return null},saveComicRecord:function(id,seq,cid,title,artist,cover){var self=this,data=self.dataComic,d=self.loadComicRecord(id),oldTitle=d&&d.title,oldArtist=d&&d.artist,oldCover=d&&d.cover;if(!d){d={};data.push(d)}d.time=(new Date).getTime();d.id=id;d.seq=seq;d.cid=cid;d.title=title||oldTitle||"..";d.artist=artist||oldArtist||"..";
d.cover=cover||oldCover||"";self.save();return true},deleteComicRecord:function(ids){var self=this,data=self.dataComic;if(!ids.length)ids=[ids];ids.forEach(function(id){var deleted=self.loadComicRecord(id),pos=data.indexOf(deleted);if(pos<0)return;data.splice(pos,1)});self.save();return true},sync:function(cb){var self=this,data=self.dataComic;if(!data||!data.length)return;self._syncServerTime(function(timeSpan){self._uploadToServer(timeSpan,function(res){var status=res&&res.status||0,data=res&&res.data||
{},exceptIds=data["fail_ids"]||[];if(status==2){self.clear(exceptIds);cb&&cb(res)}else console.error("\u9605\u8bfb\u8bb0\u5f55\u540c\u6b65\u5931\u8d25: ",status)})})},_uploadToServer:function(timeSpan,cb){var self=this,data=self.dataComic,tmp=[],startTime=null;for(var id in data){var d=data[id],time=(d.time/1E3|0)+timeSpan;tmp.push(d.id+"-"+d.cid+"-"+d.seq+"-"+time);if(time<startTime||startTime===null)startTime=time}ek.ajax({url:"/Bookshelf/updateReadHistory",type:"post",data:{startTime:startTime,
history:tmp.join(",")},success:function(res){cb&&cb(res)}})},_syncServerTime:function(cb){ek.ajax({url:"/Ajax/getTimeStamp",type:"post",success:function(res){var status=res&&res.status||null,data=res&&res.data||{},stamp=data.stamp||0,localStamp=(new Date).getTime()/1E3|0;cb&&cb(status===2?stamp-localStamp:0)}})},loadChapterProgress:function(id,cid){var self=this,data=self.dataChapter,cs=data[id]||{},cur=cs[cid]||1;return cur},saveChapterProgress:function(id,cid,cur){var self=this,data=self.dataChapter,
cs=data[id]={};cs[cid]=cur;self.save()}});window.LocalHistory=LocalHistory;if(typeof module!="undefined"&&module.exports)module.exports=LocalHistory})();
$(function(){var REPORTSTR=HOT_TAG_ROOT+"comicInfo";var REPORTSTR2=HOT_TAG_ROOT+"recommend";var aid=ek.urlHelper.getQueryString("aid");var backToTop=new BackToTop({cssStyle:{"zIndex":"10","bottom":"15%"}});var clientType=ek.isAndroid;console.log(clientType);var refer=document.referrer;refer.toLowerCase();if(refer.indexOf("sogou.com")>0)$(".app-guiding").hide();var md_Mt=new BIU.Model({name:"md_Mt",load:function(id){var that=this;ek.ajax({url:"/comic/getMonthTicketInfo",data:{id:id},success:function(res){that.set(res)}})}});
var md_UserInfo=PagePreset["md_UserInfo"]||new BIU.Model({name:"md_UserInfo",load:function(id){var that=this;ek.ajax({url:"/comic/getUserInfo",data:{id:id},success:function(res){console.log("<hr/>");console.log("md_UserInfo:\n",res);that.set(res)}})},pageReady:function(){var that=this;window.addEventListener("popstate",function(){that.load(that.page.id)});this.load(this.page.id)}});var md_UserAddFav=new BIU.Model({name:"md_UserAddFav",load:function(id,token){var that=this;ek.ajax({url:"/Bookshelf/addCollection",
type:"post",data:{"id":id,"tokenKey":token},success:function(res){that.set(res)}})}});var md_UserDelFav=new BIU.Model({name:"md_UserDelFav",load:function(id,token){var that=this;ek.ajax({url:"/Bookshelf/delCollection",type:"post",data:{"id":id,"tokenKey":token},success:function(res){that.set(res)}})}});var md_LocalHistory=new LocalHistory({name:"md_LocalHistory",pageReady:function(){var that=this;window.addEventListener("popstate",function(){that.read()})}});var md_SyncHistory=new BIU.Model({name:"md_SyncHistory",
load:function(){md_LocalHistory.sync()}});var md_Svip=new BIU.Model({name:"md_Svip",load:function(){var that=this;$.ajax({url:"//cgi.vip.qq.com/getsvipcartooninfo/index",type:"get",async:false,dataType:"jsonp",jsonp:"callback",jsonpCallback:"success_jsonpCallback",success:function(res){that.set(res)},error:function(err){}})}});var vw_ModHead=new BIU.View({name:"vw_ModHead",pageReady:function(){var that=this,page=that.page;page&&page.load("md_Mt",page.id)},listen:{"md_Mt":function(res){var that=this;
if(res&&res.status==2)$("#txt_mtNumber").html(res.monthTicket);else if(res&&res.status==1)$(".head-info-mt").hide()}}});var vw_TapChange=new BIU.View({name:"vw_TapChange",pageReady:function(){vw_CommentList.disable();backToTop.disable()},events:{"click .tab-list":function(e){var $target=$(e.target).closest(".tab-list-item")[0];var tabName=$($target).attr("data-tab-link");var $$lay_content=$(".lay-content");var $$tab_list_item=$(".tab-list-item");var $mod_toolBar=$(".mod-toolBar");if(!tabName)return;
$$lay_content.hide();$$tab_list_item.removeClass("active");$$lay_content.filter("[data-tab-name="+tabName+"]").show();$($target).addClass("active");if(tabName=="detail"){ek.ping.reportClick(REPORTSTR+".detail");$mod_toolBar.show();backToTop.disable();vw_CommentList.disable()}else if(tabName=="comicList"){ek.ping.reportClick(REPORTSTR+".comic_list");$mod_toolBar.show();backToTop.disable();vw_CommentList.disable()}else if(tabName=="comment"){ek.ping.reportClick(REPORTSTR+".comment");$mod_toolBar.hide();
backToTop.enable();vw_CommentList.enable()}}}});var vw_VipComicInfo=new BIU.View({name:"vw_VipComicInfo",listen:{"md_UserInfo":function(res){var $info_pay_text=$("#info_pay_text");var page=this.page}},events:{"click #btn_payVip":function(e){var $target=$(e.target).closest("#btn_payVip");if($target.length>0)window.location.href="http://m.ac.qq.com/event/payGuide201706/index.html"}}});var vw_ChapterList=new BIU.View({name:"vw_ChapterList",listen:{"md_UserInfo":function(res){var that=this;console.log("<hr/>");
console.log("popstate3 md_LocalHistory.DataComic:",md_LocalHistory.dataComic);var localSeq=md_LocalHistory.loadComicRecord(this.page.id);if(res&&res.status==2){var $comicList_all=$(".chapter-list");var chapterIds=res.data.bought_info&&res.data.bought_info.bought_chapter_ids;if(chapterIds)for(var i=0,j=chapterIds.length;i<j;i++)$comicList_all.find('a[data-cid="'+chapterIds[i]+'"]').removeClass("lock");if(that.page.vip_free_state==2&&res.data.is_vip_user)$comicList_all.find("a.lock").removeClass("lock");
var cloudSeq=res.data.seq_no;if(cloudSeq>0){$comicList_all.find("a[data-seq]").removeClass("now");$comicList_all.find('a[data-seq="'+cloudSeq+'"]').addClass("now")}}else if(res&&res.status==-99)if(localSeq){$(".chapter-list a").removeClass("now");$(".chapter-list").find('a[data-seq="'+localSeq.seq+'"]').addClass("now")}}},events:{"click #btn_expandChapterList":function(e){var target=e&&e.target,btn=$(target).closest("#btn_expandChapterList")[0];if(btn)ek.ping.reportClick(REPORTSTR+".more")}}});var vw_CommentList=
new View_CommentList({name:"vw_CommentList",listName:"#mod_comment",id:pg_ComicInfo.id,pageIndex:pg_ComicInfo.pageIndex,pageSize:pg_ComicInfo.pageSize});var vw_svip=new BIU.View({name:"vw_svip",pageReady:function(){var self=this,page=self.page;var fromSvip=ek.urlHelper.getQueryString("from");self.fromSvip=fromSvip;if(clientType&&fromSvip)page&&page.load("md_Svip")},events:{"click .svip-guiding":function(e){var self=this;var offerId=0;var $dom=$(e&&e.target),$close=$dom.is(".svip-guiding-close")?$dom:
$dom.parents(".svip-guiding-close");var $parent=$dom.parents(".svip-guiding");if($close.length)$parent.addClass("hide");else{if(self.fromSvip)offerId=1450015301;else offerId=1450015347;unionPay.unionOpen({type:"tdmvip",offerid:offerId,aid:aid,disableQuitPay:true,onPayCallback:function(result){if(result.ret==0)window.location.reload()}})}}},listen:{"md_Svip":function(res){if(res.ret==0)if(res.data.is_cartoon_vip==0||res.data.is_cartoon_vip==null){$(".app-guiding").addClass("hide");$(".svip-guiding").removeClass("hide")}else $(".svip-guiding").addClass("hide")}}});
var vw_Toolbar=new BIU.View({name:"vw_Toolbar",pageReady:function(){},listen:{"md_UserInfo":function(res){var that=this;if(res&&res.status==2){if(res.data.token)TokenKey.set(res.data.token);if(res.data.is_coll)$("#btn_toolFav").removeClass("unfav").addClass("faved");if(res.data.seq_no>0)$("#btn_toolRead").html("\u7eed\u770b"+res.data.seq_no+"\u8bdd").attr("href","/chapter/index/id/"+that.page.id+"/seqno/"+res.data.seq_no)}else if(res&&res.status==-99){var localHis=md_LocalHistory.loadComicRecord(that.page.id);
if(localHis)$("#btn_toolRead").html("\u7eed\u770b"+localHis.seq+"\u8bdd").attr("href","/chapter/index/id/"+that.page.id+"/seqno/"+localHis.seq)}$("#btn_toolRead").trigger("gotHistory")},"md_UserAddFav":function(res){if(res&&res.status==2){$("#btn_toolFav").removeClass("unfav").addClass("faved");Dialog.toast("\u6536\u85cf\u6f2b\u753b\u6210\u529f")}else if(res&&res.status==-99)pageAction.goLogin();else if(res&&res.status==1)Dialog.toast("\u6536\u85cf\u6f2b\u753b\u5931\u8d25")},"md_UserDelFav":function(res){if(res&&
res.status==2){$("#btn_toolFav").removeClass("faved").addClass("unfav");Dialog.toast("\u53d6\u6d88\u6536\u85cf\u6210\u529f")}else if(res&&res.status==-99)pageAction.goLogin();else if(res&&res.status==1)Dialog.toast("\u53d6\u6d88\u6536\u85cf\u5931\u8d25")}},events:{"click .mod-toolBar":function(e){var that=this;var $target_share=$(e.target).closest("#btn_toolShare");var $target_addFav=$(e.target).closest("#btn_toolFav.unfav");var $target_delFav=$(e.target).closest("#btn_toolFav.faved");var $target_read=
$(e.target).closest("#btn_toolRead");var $target_download=$(e.target).closest("#btn_toolDownload");var page=that.page;if($target_share.length>0){ek.ping.reportClick(REPORTSTR+".share");that.page&&that.page.trigger("showShare")}else if($target_addFav.length>0){ek.ping.reportClick(REPORTSTR+".add_fav");TokenKey.get(function(token){page.load("md_UserAddFav",page.id,token||"")})}else if($target_delFav.length>0){ek.ping.reportClick(REPORTSTR+".del_fav");TokenKey.get(function(token){page.load("md_UserDelFav",
page.id,token||"")})}else if($target_download.length>0){var appUrls=page.appUrl;ek.ping.reportClick(REPORTSTR+".download.show_dialog");var comicId=page.id;ek.appScheme.detail(comicId).or(function(){var appUrl=ek.isAndroid?appUrls["android_btn"]:ek.isIOS?appUrls["ios_btn"]:null;ek.ping.downAppAndReport(appUrl)})}else if($target_read.length>0)ek.ping.reportClick(REPORTSTR+".read")}}});var vw_Recommend=new BIU.View({"name":"vw_Recommend",events:{"click .comic-link":function(e){var $target=$(e.target).closest(".list_recommend3 .comic-link");
if($target.length>0){var reportStr=$target.attr("data-reportStr");ek.ping.reportClick(REPORTSTR2+"."+reportStr)}}}});var vw_SameNameAnimation=new BIU.View({"name":"vw_SameNameAnimation",events:{"click .lay-content":function(e){var $target=$(e.target).closest(".mod-animationList .animation-link");if($target.length>0){var reportStr=$target.attr("data-reportStr");ek.ping.reportClick(REPORTSTR+"."+reportStr)}}}});var vw_Control_History=new BIU.View({name:"vw_Control_History",listen:{"md_UserInfo":function(res){var that=
this;if(res.status==2){if(md_LocalHistory.load())Dialog.toast("\u6b63\u5728\u540c\u6b65\u4e91\u7aef\u5386\u53f2\u8bb0\u5f55");md_LocalHistory.sync(function(res2){if(res2.status==1)Dialog.toast("\u90e8\u5206\u5386\u53f2\u8bb0\u5f55\u672a\u80fd\u540c\u6b65\u6210\u529f");that.page.load("md_UserInfo",that.page.id)})}}}});var vw_ShareDialog=new ShareDialog({name:"vw_ShareDialog"});var vw_Guiding=new BIU.View({name:"vw_Guiding",init:function(){},showGuiding:function(){Guiding.show("comic","tabs",function(){Guiding.show("comic",
"coll");Guiding.setFlag("comic",true)})},isNewUser:function(){var value=Guiding.getFlag("comic");return value===undefined||value===false}});pg_ComicInfo.addView(vw_svip);pg_ComicInfo.addModel(md_Svip);pg_ComicInfo.addModel(md_CommentList);pg_ComicInfo.addModel(md_CommentLike);pg_ComicInfo.addModel(md_UserInfo);pg_ComicInfo.addModel(md_Mt);pg_ComicInfo.addModel(md_UserAddFav);pg_ComicInfo.addModel(md_UserDelFav);pg_ComicInfo.addModel(md_LocalHistory);pg_ComicInfo.addView(vw_CommentList);pg_ComicInfo.addView(vw_TapChange);
pg_ComicInfo.addView(vw_ModHead);pg_ComicInfo.addView(vw_VipComicInfo);pg_ComicInfo.addView(vw_Toolbar);pg_ComicInfo.addView(vw_Recommend);pg_ComicInfo.addView(vw_SameNameAnimation);pg_ComicInfo.addView(vw_ChapterList);pg_ComicInfo.addView(vw_Control_History);pg_ComicInfo.addView(vw_Guiding);pg_ComicInfo.addView(vw_ShareDialog);pg_ComicInfo.pageReady()});
